<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-09-14">

<title>OTS TBCP 2024 - Linear regression models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">OTS TBCP 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text"> </span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./r_basics.html">
 <span class="dropdown-text">R basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./importing_data.html">
 <span class="dropdown-text">Import and format data in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./simulate_data.html">
 <span class="dropdown-text">Simulating data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./linear_regression.html">
 <span class="dropdown-text">Regression models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ggplot2.qmd">
 <span class="dropdown-text">Elegant graphs with ggplot2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./course_prep.html"> 
<span class="menu-text">Course prep</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://codefile.io/f/inMsojTFoN"> 
<span class="menu-text">Sharing code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructor.html"> 
<span class="menu-text">Instructor</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maRce10/OTS_TBCP_2024"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#linear-models-as-a-unifying-framework" id="toc-linear-models-as-a-unifying-framework" class="nav-link active" data-scroll-target="#linear-models-as-a-unifying-framework"><span class="header-section-number">1</span> Linear models as a unifying framework</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression"><span class="header-section-number">2</span> Simple linear regression</a></li>
  <li><a href="#linear-regression-in-r" id="toc-linear-regression-in-r" class="nav-link" data-scroll-target="#linear-regression-in-r"><span class="header-section-number">3</span> Linear regression in R</a>
  <ul class="collapse">
  <li><a href="#response-intercept-only-model" id="toc-response-intercept-only-model" class="nav-link" data-scroll-target="#response-intercept-only-model"><span class="header-section-number">3.1</span> Response (intercept)-only model</a></li>
  <li><a href="#adding-a-non-associated-predictor" id="toc-adding-a-non-associated-predictor" class="nav-link" data-scroll-target="#adding-a-non-associated-predictor"><span class="header-section-number">3.2</span> Adding a non-associated predictor</a></li>
  <li><a href="#simulating-an-associated-predictor" id="toc-simulating-an-associated-predictor" class="nav-link" data-scroll-target="#simulating-an-associated-predictor"><span class="header-section-number">3.3</span> Simulating an associated predictor</a></li>
  <li><a href="#adding-more-than-1-predictor-multiple-regression" id="toc-adding-more-than-1-predictor-multiple-regression" class="nav-link" data-scroll-target="#adding-more-than-1-predictor-multiple-regression"><span class="header-section-number">3.4</span> Adding more than 1 predictor: multiple regression</a></li>
  <li><a href="#having-a-categorical-predictor" id="toc-having-a-categorical-predictor" class="nav-link" data-scroll-target="#having-a-categorical-predictor"><span class="header-section-number">3.5</span> Having a categorical predictor</a></li>
  <li><a href="#interaction-terms" id="toc-interaction-terms" class="nav-link" data-scroll-target="#interaction-terms"><span class="header-section-number">3.6</span> Interaction terms</a></li>
  </ul></li>
  <li><a href="#extending-the-linear-models-to-more-complex-data-structures" id="toc-extending-the-linear-models-to-more-complex-data-structures" class="nav-link" data-scroll-target="#extending-the-linear-models-to-more-complex-data-structures"><span class="header-section-number">4</span> Extending the linear models to more complex data structures</a>
  <ul class="collapse">
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models"><span class="header-section-number">4.1</span> Generalized linear models</a></li>
  <li><a href="#mixed-effect-models" id="toc-mixed-effect-models" class="nav-link" data-scroll-target="#mixed-effect-models"><span class="header-section-number">4.2</span> Mixed-effect models</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">4.3</span> References</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><font size="7"><b>Linear regression models</b></font></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objectives" class="level1 unnumbered unlisted alert alert-info">
<h1 class="unnumbered unlisted">Objectives</h1>
<ul>
<li><p>Understand statistical inference through a single modelling tool (broad sense linear models)</p></li>
<li><p>Get familiar with building linear models</p></li>
<li><p>Extent linear models to different data structures</p></li>
</ul>
</section>
<section id="linear-models-as-a-unifying-framework" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Linear models as a unifying framework</h1>
<p>Traditionally, statistical models have been taught as disconnected tools with no clear relationship between them. Take a look at a classic biology stats book (Sokal &amp; Rolhf):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/sokal_rohlf.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>However, most of those common statistical models are just special cases of linear models. Hence, learning them as such can largely simplify things. This approach has several advantages:</p>
<ul>
<li><p>First of all, <strong>it all comes down to <em>y=a⋅x+b</em></strong>, which largely simplify learning</p></li>
<li><p>This also means that there is <strong>no need to learn about parameters, assumptions, and result interpretation for every single special case</strong></p></li>
<li><p>Linear models have been extended to <strong>account for complex distributions and data structures</strong> (e.g.&nbsp;mixed models, generalized linear models, zero-inflated models, etc) providing a <strong>more flexible platform</strong>.</p></li>
<li><p>Linear models are <strong>applied across statistical paradigms</strong> (e.g.&nbsp;frequentist, bayesian)</p></li>
</ul>
<p>Please load the following packages:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="simple-linear-regression" class="level1 alert alert-warning" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Simple linear regression</h1>
<p>Linear regressions are based on the linear equation <em>a = mx + b</em> we learned in high school. The formal representation looks like this:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}\)</span></font></p>
<ul>
<li><p><span class="math inline">\(\hat{Y}\)</span>: response variable</p></li>
<li><p><span class="math inline">\(\beta_{o}\)</span>: intercept (y value)</p></li>
<li><p><span class="math inline">\(\beta_{1}\)</span>: estimate of the magnitude of the effect of <span class="math inline">\(x_{1}\)</span> on <span class="math inline">\(\hat{Y}\)</span> (a.k.a. effect size, coefficient or simply the ‘estimate’)</p></li>
<li><p><span class="math inline">\(x_{1}\)</span>: predictor variable</p></li>
</ul>
<p>The most common goal of a linear regression is estimating the <span class="math inline">\(\beta_{*}\)</span> values. This is achieved by finding the best fitting straight line representing the association between a predictor and the response:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/regression-2.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Those <span class="math inline">\(\beta_{*}\)</span>s are the estimated effect size of the correspondent predictor (e.g.&nbsp;<span class="math inline">\(\beta_{1}\)</span> is the effect size <span class="math inline">\(x_{1}\)</span>). Their value represent the mean change in <span class="math inline">\(\hat{Y}\)</span> (in <span class="math inline">\(\hat{Y}\)</span> units) for a unit of change in <span class="math inline">\(\beta_{*}\)</span>. Hence the null hypothesis is that those <span class="math inline">\(\beta_{*}\)</span>s are not different from 0:</p>
<p><font size="6"><span class="math inline">\(\qquad \mathcal{H}_0: \hat{Y} = \beta_0 + 0 * x_{1}\)</span></font></p>
<p>which is equivalent to this:</p>
<p><font size="6"><span class="math inline">\(\qquad \mathcal{H}_0: \hat{Y} = \beta_0\)</span></font></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/model_betas.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="linear-regression-in-r" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Linear regression in R</h1>
<p>To take full advantage of linear models we need to feel comfortable with them. We will do this by exploring R’s linear regression function <code>lm()</code>. In R most linear models and their extensions share common data input and output formats which makes easy to apply them once we understand their basics.</p>
<p>We will use the data set ‘trees’ that comes by default with R. ‘trees’ provides measurements of the <strong>diameter</strong> (labeled as ‘Girth’), <strong>height</strong> and <strong>volume</strong> of 31 felled black cherry trees:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Girth</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Height</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">8.3</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">10.3</td>
</tr>
<tr class="even">
<td style="text-align: center;">8.6</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">10.3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8.8</td>
<td style="text-align: center;">63</td>
<td style="text-align: center;">10.2</td>
</tr>
<tr class="even">
<td style="text-align: center;">10.5</td>
<td style="text-align: center;">72</td>
<td style="text-align: center;">16.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10.7</td>
<td style="text-align: center;">81</td>
<td style="text-align: center;">18.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">10.8</td>
<td style="text-align: center;">83</td>
<td style="text-align: center;">19.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The basic R function to build a linear model is <code>lm()</code>. Let’s look at the basic components of a regression model using <code>lm()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/lm2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can fit this model to look at the output:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>reg_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Height <span class="sc">~</span> Girth, <span class="at">data =</span> trees)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Height ~ Girth, data = trees)

Residuals:
    Min      1Q  Median      3Q     Max 
-12.582  -2.769   0.316   2.473   9.946 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   62.031      4.383   14.15  1.5e-14 ***
Girth          1.054      0.322    3.27   0.0028 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.54 on 29 degrees of freedom
Multiple R-squared:  0.27,  Adjusted R-squared:  0.244 
F-statistic: 10.7 on 1 and 29 DF,  p-value: 0.00276</code></pre>
</div>
</div>
<p>This is what the elements of the output mean:</p>
<ul>
<li><p><strong>Call</strong>: the function and parameters were used to create the model</p></li>
<li><p><strong>Residuals</strong>: distribution of the residuals. Residuals are the difference between what the model predicted and the actual value of y. This is a graphic representation of the residuals:</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><strong>Coefficients</strong>: this one contains the effect sizes (‘Estimates’), a measure of their uncertainty (‘Std. Error’), the associated statistic (‘t value’) and p value (‘Pr(&gt;|t|)’). Estimates are given as the mean change in y for every increase in 1 unit in x. So for this example is 1.0544 <span class="math inline">\(in / in\)</span>. Despite the fact that the units will cancel out (`1.0544 <span class="math inline">\(in / in\)</span> = 1.0544) keeping them in mind is still biologically meaningful. They mean that, in average, and 1 inch increase in girth you will expect an increase of 1.0544 inches in height.</p></li>
<li><p><strong>Residual standard error</strong>: self-explanatory. The standard error of the residuals</p></li>
<li><p><strong>Multiple R-squared</strong>: the coefficient of determination, this is intended as a measurement of how well your model fits to the data</p></li>
<li><p><strong>Adjusted R-Squared</strong>: similar to the ‘Multiple R-squared’ but penalized for the number of parameters</p></li>
<li><p><strong>F-statistic</strong>: statistic for a global test that checks if at least one of your coefficients are non-zero</p></li>
<li><p><strong>p-value</strong>: probability for a global test that checks if at least one of your coefficients are non-zero</p></li>
</ul>
<p>We will use <code>lm()</code> to showcase the flexibility of regression models. Regression components will be added gradually so we can take time of understand each of them as well as the correspondent changes in the regression output.</p>
<section id="response-intercept-only-model" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="response-intercept-only-model"><span class="header-section-number">3.1</span> Response (intercept)-only model</h2>
<p>Let’s first create a response numeric variable:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># put it in a data frame</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>y_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This single variable can be input in an <strong>intercept-only regression model</strong>. To do this we need to supply the model formula and the data to <code>lm()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> y_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Which is equivalent to:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o}\)</span></font></p>
<p>We can get the default summary of the model results by running <code>summary()</code> on the output object ‘y_mod’:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ 1, data = y_data)

Residuals:
   Min     1Q Median     3Q    Max 
-2.001 -0.594 -0.107  0.664  2.135 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   0.0344     0.1309    0.26     0.79

Residual standard error: 0.926 on 49 degrees of freedom</code></pre>
</div>
</div>
<p>It can be quite informative to plot the effect sizes (although in this case we just have one):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(y_mod<span class="sc">$</span>coefficients),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> y_mod<span class="sc">$</span>coefficients, <span class="fu">confint</span>(y_mod))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>For assessing the significance of the association we focus on the coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 0.034404    0.13094 0.26275  0.79385</code></pre>
</div>
</div>
<ul>
<li><p>In this example there are no predictors in the model so we only got an estimate for the intercept (<span class="math inline">\(\beta_0\)</span>)</p></li>
<li><p>The model tell us that the intercept is estimated at 0.0344 and that this value is not significantly different from 0 (p-value = 0.79385)</p></li>
<li><p>In this case the intercept is simply the mean of the response variable</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y_data<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.034404</code></pre>
</div>
</div>
<ul>
<li>We seldom have predictions about the intercept so we tend to ignore this estimate.</li>
</ul>
</div>
<div class="alert alert-warning">
<center>
<font size="5"><b>Case study</b></font>
</center>
<ul>
<li>Ruhs, E. C., Martin, L. B., &amp; Downs, C. J. (2020). <a href="https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.0655?download=true"><strong>The impacts of body mass on immune cell concentrations in birds</strong></a>. <em>Proceedings of the Royal Society B</em>, 287(1934), 20200655.</li>
</ul>
<p>“<em>We found that an intercept-only model best explained lymphocyte and eosinophil concentrations in birds, indicating that concentrations of these cell types were independent of body mass.</em>”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/leukocytes.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li><p>Change the <code>mean</code> argument in the <code>rnorm()</code> function call to a value other than 0 and look at how things change in the coefficients table</p></li>
<li><p>Change the <code>sd</code> argument in the <code>rnorm()</code> function call to a higher value and look at how things change in the coefficients table</p></li>
</ul>
</div>
<hr>
</section>
<section id="adding-a-non-associated-predictor" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="adding-a-non-associated-predictor"><span class="header-section-number">3.2</span> Adding a non-associated predictor</h2>
<p>We can create 2 unrelated numeric variables like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>xy_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These two variables can be input in a regression model to evaluate the association between them:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()  <span class="co"># plot points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Which is equivalent to:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}\)</span></font></p>
<p>Let’s print the summary for this model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1, data = xy_data)

Residuals:
   Min     1Q Median     3Q    Max 
-2.004 -0.624 -0.123  0.687  2.106 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   0.0398     0.1340    0.30     0.77
x1           -0.0367     0.1475   -0.25     0.80

Residual standard error: 0.935 on 48 degrees of freedom
Multiple R-squared:  0.00129,   Adjusted R-squared:  -0.0195 
F-statistic: 0.0618 on 1 and 48 DF,  p-value: 0.805</code></pre>
</div>
</div>
<p>… and plot the effect sizes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod<span class="sc">$</span>coefficients),</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> xy_mod<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We should ‘diagnose’ the adequacy of the model by inspecting more closely the distribution of residuals.The function <code>plot_model()</code> from the package ‘sjPlot’ does a good job for creating diagnostic plots for linear models:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(xy_mod, <span class="at">type =</span> <span class="st">"diag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error  t value Pr(&gt;|t|)
(Intercept)  0.039774    0.13396  0.29690  0.76782
x1          -0.036679    0.14750 -0.24867  0.80467</code></pre>
</div>
</div>
<ul>
<li><p>In this example we added one predictor to the model so we got an additional estimate (and extra row, ‘x1’)</p></li>
<li><p>The model tell us that the estimate of ‘x1’ is -0.03668 and that it is not significantly different from 0 (p-value = 0.80467)</p></li>
</ul>
</div>
<hr>
</section>
<section id="simulating-an-associated-predictor" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="simulating-an-associated-predictor"><span class="header-section-number">3.3</span> Simulating an associated predictor</h2>
<p>We can use the linear model formula above to simulate two associated continuous variables like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>xy_data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that <strong>we also added an error term</strong>, so the association is not perfect. Let’s run the model and plot the association between the two variables:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>xy_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data2)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data2, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()  <span class="co"># plot points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The formula is the same than the previous model:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}\)</span></font></p>
<p>This is the summary of the model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1, data = xy_data2)

Residuals:
   Min     1Q Median     3Q    Max 
 -6.01  -1.87  -0.37   2.06   6.32 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -3.881      0.402   -9.66  7.9e-13 ***
x1             2.890      0.442    6.53  3.9e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.8 on 48 degrees of freedom
Multiple R-squared:  0.471, Adjusted R-squared:  0.459 
F-statistic: 42.7 on 1 and 48 DF,  p-value: 3.85e-08</code></pre>
</div>
</div>
<p>.. the effect size plot:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod2<span class="sc">$</span>coefficients),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> xy_mod2<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod2))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… and the model diagnostic plots:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(xy_mod2, <span class="at">type =</span> <span class="st">"diag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -3.8807    0.40188 -9.6562 7.8616e-13
x1            2.8900    0.44249  6.5311 3.8537e-08</code></pre>
</div>
</div>
<ul>
<li><p>The model tells us that <span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1’) is 2.88996 and that it is significantly different from 0 (p-value = 3.85365^{-8})</p></li>
<li><p>The simulated values for the regression parameters can be compared to the summary of the <code>lm()</code> model to get a sense of the model precision:</p>
<ul>
<li><span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1’) was set to 3 and was estimated as 2.89 by the model</li>
</ul></li>
</ul>
</div>
<div class="alert alert-warning">
<center>
<font size="5"><b>Case study</b></font>
</center>
<ul>
<li>Keenan EL, Odom KJ, Araya-Salas M, Horton KG, Strimas-Mackey M, Meatte MA, Mann NI, Slater PJ, Price JJ, and Templeton CN. 2020. <a href="https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.2482"><strong>Breeding season length predicts duet coordination and consistency in Neotropical wrens (Troglodytidae)</strong></a>. <em>Proceeding of the Royal Society B</em>. 20202482</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/duets.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>“<em>… coordination and consistency of duets are greater in species with particularly long mating seasons.</em>”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/duet_reg.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li><p>Increase the sample size (<code>n</code>) to 1000 or higher</p></li>
<li><p>How did the effect size (<span class="math inline">\(\beta\)</span>) estimates change?</p></li>
<li><p>How did the standard error of the effect size change?</p></li>
<li><p>Now change <code>n</code> to 15 and check again the model estimates (this time check the p-value as well)</p></li>
</ul>
</div>
<hr>
</section>
<section id="adding-more-than-1-predictor-multiple-regression" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="adding-more-than-1-predictor-multiple-regression"><span class="header-section-number">3.4</span> Adding more than 1 predictor: multiple regression</h2>
<p>Multiple linear regression is an extension of the simple linear regression model that can take several predictors:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \cdots + \beta_{n} * x_{n}\)</span></font></p>
<p>The formula looks a bit busy, but it only means that any additional parameter will have its own estimate (<span class="math inline">\(\beta\)</span>). The formula for a two-predictor linear regression looks like this:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \beta_{2} * x_{2}\)</span></font></p>
<p>.. and it can be simulated like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>xy_data_multp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>xy_mod_multp <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> xy_data_multp)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_multp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2, data = xy_data_multp)

Residuals:
   Min     1Q Median     3Q    Max 
-5.986 -1.893 -0.363  2.002  6.413 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -3.865      0.417   -9.27  3.5e-12 ***
x1             2.901      0.453    6.41  6.4e-08 ***
x2            -1.932      0.414   -4.67  2.6e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.83 on 47 degrees of freedom
Multiple R-squared:  0.612, Adjusted R-squared:  0.595 
F-statistic:   37 on 2 and 47 DF,  p-value: 2.23e-10</code></pre>
</div>
</div>
<p>… plot the effect sizes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_multp<span class="sc">$</span>coefficients),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> xy_mod_multp<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_multp))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… and the model diagnostic plots:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(xy_mod_multp, <span class="at">type =</span> <span class="st">"diag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -3.8652    0.41695 -9.2702 3.4856e-12
x1            2.9015    0.45260  6.4108 6.4137e-08
x2           -1.9324    0.41422 -4.6650 2.5851e-05</code></pre>
</div>
</div>
<ul>
<li><p>The model found that <span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1’) is 2.9015 and that it is significantly different from 0 (p-value = 6.41368^{-8})</p></li>
<li><p>It also found that the <span class="math inline">\(\beta_2\)</span> (the effect size of ‘x2’) is -1.93235 and that it is also significantly different from 0 (p-value = 2.58513^{-5})</p></li>
<li><p>The simulated values for the regression parameters can be compared to the summary of the <code>lm()</code> model to get a sense of the model precision:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> was set to 3 and was estimated as 2.901</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> (the effect size of ‘x2’) was set to -2 and was estimated as -1.932</p></li>
</ul></li>
</ul>
</div>
<div class="alert alert-warning">
<center>
<font size="5"><b>Case study</b></font>
</center>
<ul>
<li>Araya-Salas M, P González-Gómez, K Wojczulanis-Jakubas, V López III &amp; T Wright. 2018. <a href="https://www.nature.com/articles/s41598-018-20441-x"><strong>Spatial memory is as important as weapon and body size for territorial ownership in a lekking hummingbird</strong></a>. <em>Scientific Reports</em>. 13, e0189969</li>
</ul>
<p>“<em>Spatial memory, body size and beak tip length … positively predicted the probability of acquiring and defending a territory.</em>”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/lbh_cognition.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li><p>Set one of the effect sizes (<span class="math inline">\(\beta\)</span>) to 0 (or very close to 0) and run again the model and its summary</p></li>
<li><p>How did the p-value change?</p></li>
<li><p>Simulate a scenario with two predictors in which only one of them is associated with the response</p></li>
</ul>
</div>
<p>There is an important point to stress here: <strong>Multiple regression estimate the effect of a predictor after accounting for the effect of the other predictors in the model</strong>. In other words, new predictors in the model will attempt to explain variation in the data that was not explained by the other predictors. So <strong>the result of the multiple regression is not equivalent to the results of simple linear regressions</strong> on the same predictors. This can be easily shown by running those regressions:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build models</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>x2y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2, <span class="at">data =</span> xy_data)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># shortcut to coefficients</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(xy_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1 
   0.039774   -0.036679 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x1y_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1 
   0.039774   -0.036679 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x2y_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x2 
   0.041320    0.027239 </code></pre>
</div>
</div>
<p>The estimates for the same variables vary considerably between the multiple regression and the single predictor regressions.</p>
<p>This point is further demonstrated by the fact that, if one of the predictors has no influence at all on the response, the effect of the additional predictor will converge to its effect in a simple linear regression. To simulate this scenario we set b2 to 0:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>xy_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_data)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># shortcut to coefficients</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(xy_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1          x2 
  -3.955064    2.967166    0.022549 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x1y_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1 
    -3.9602      2.9633 </code></pre>
</div>
</div>
<p>The estimate for <span class="math inline">\(\beta_1\)</span> was almost the same in the multiple regression (2.96717) and the single predictor regression (2.96332)</p>
<p>For convenience we used <code>coef()</code> to extract only the estimates from the regression, but the values are the same we get with <code>summary(model)</code>.</p>
<hr>
</section>
<section id="having-a-categorical-predictor" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="having-a-categorical-predictor"><span class="header-section-number">3.5</span> Having a categorical predictor</h2>
<p>For categorical predictors we can first create a binary (0, 1) variable and then add labels to each value:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>x1_num <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1_num <span class="sc">+</span> error</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1_num, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>xy_data_cat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x1_num, y)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">x1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">x1_num</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">b</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.6630</td>
</tr>
<tr class="even">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">-3.8408</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2.3255</td>
</tr>
<tr class="even">
<td style="text-align: center;">b</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-0.4380</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.4276</td>
</tr>
<tr class="even">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">-1.7534</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>And this is how it is formally written:</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}\)</span></font></p>
<p>Same thing as with continuous predictors.</p>
<p>We can explore the pattern in the data using a boxplot:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data_cat, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… and get the estimates of the model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>xy_mod_cat <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data_cat)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1, data = xy_data_cat)

Residuals:
   Min     1Q Median     3Q    Max 
-5.898 -1.909 -0.094  1.809  5.506 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -2.997      0.558   -5.37  2.3e-06 ***
x1b            1.814      0.842    2.16    0.036 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.95 on 48 degrees of freedom
Multiple R-squared:  0.0882,    Adjusted R-squared:  0.0693 
F-statistic: 4.65 on 1 and 48 DF,  p-value: 0.0362</code></pre>
</div>
</div>
<p>… plot the effect sizes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_cat<span class="sc">$</span>coefficients),</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> xy_mod_cat<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_cat))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… and the model diagnostic plots:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(xy_mod_cat, <span class="at">type =</span> <span class="st">"diag"</span>)[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -2.9974    0.55825 -5.3693 2.2677e-06
x1b           1.8140    0.84160  2.1554 3.6172e-02</code></pre>
</div>
</div>
<ul>
<li><p>The model found that <span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1’) is 1.814 and that it is significantly different from 0 (p-value = 0.03617)</p></li>
<li><p>The simulated values for the regression parameters can be compared to the summary of the <code>lm()</code> model to get a sense of the model precision:</p>
<ul>
<li><span class="math inline">\(\beta_1\)</span> was set to 2 and was estimated as 1.814</li>
</ul></li>
<li><p>Note that in this case the intercept refers to the estimate for the level ‘a’ in the categorical predictor, which was used as a baseline:</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data_cat, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> xy_mod_cat<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Hence the intercept is the same as the mean of y for the category ‘a’:</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(xy_data_cat<span class="sc">$</span>y[xy_data_cat<span class="sc">$</span>x1 <span class="sc">==</span> <span class="st">"a"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.9974</code></pre>
</div>
</div>
<ul>
<li>Note also that the estimate label is ‘x1b’, not ‘x1’ as in the continuous predictors. This is because in this case the estimate refers to the difference between the two levels of the categorical variable (‘a’ and ‘b’). More specifically, it tells us that in average observations from category ‘b’ are 1.814 higher than observations in category ‘a’.</li>
</ul>
</div>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<ul>
<li>Rico-Guevara A, &amp; M Araya-Salas. 2015. <a href="https://academic.oup.com/beheco/article/26/1/21/2262689"><strong>Bills as daggers? A test for sexually dimorphic weapons in a lekking hummingbird species</strong></a>. <em>Behavioral Ecology</em>. 26 (1): 21-29.</li>
</ul>
<p>“<em>Males with larger, more pointed beak tips were more successful in gaining control of territories in the lek.</em>”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/daggers_lbh.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li>Unbalanced data when having categories (i.e.&nbsp;some categories have way more observations than others) can be problematic for statistical inference. Modify the code <a href="#cb99-1">above</a> to simulate a highly unbalanced data set and check the precision of the model.</li>
</ul>
</div>
<hr>
<div class="alert alert-warning">
<p><font size="6">Dummy coding</font></p>
<p>In a regression model categorical predictors are also represented as numeric vectors. More precisely, categorical predictors are coded as 0s and 1s, in which 1 means ‘belongs to the same category’ and 0 ‘belongs to a different category’. We kept the original numeric vector (‘x1_num’) when simulating the data set with the categorical predictor:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">x1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">x1_num</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">b</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.6630</td>
</tr>
<tr class="even">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">-3.8408</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2.3255</td>
</tr>
<tr class="even">
<td style="text-align: center;">b</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-0.4380</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.4276</td>
</tr>
<tr class="even">
<td style="text-align: center;">a</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">-1.7534</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that ‘b’s in the ’x1’ column are converted into 1 in the ‘x1_num’ column and ’a’s converted into 0. This is called an indicator variable and the process is known as dummy coding.</p>
<p>We can actually use the numeric vector in the regression model and get the exact same results:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary model with categorical</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variable</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_cat)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -2.9974    0.55825 -5.3693 2.2677e-06
x1b           1.8140    0.84160  2.1554 3.6172e-02</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model with dummy variable</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>xy_mod_num <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1_num, <span class="at">data =</span> xy_data_cat)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summary with dummy coding</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_num)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -2.9974    0.55825 -5.3693 2.2677e-06
x1_num        1.8140    0.84160  2.1554 3.6172e-02</code></pre>
</div>
</div>
<p>Things get a bit more complicated when dummy coding a categorical predictor with more than two levels. But the logic is the same.</p>
</div>
<hr>
</section>
<section id="interaction-terms" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="interaction-terms"><span class="header-section-number">3.6</span> Interaction terms</h2>
<p>A statistical interaction refers to an effect of a response variable that is mediated by a second variable.</p>
<p><font size="6"><span class="math inline">\(\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \beta_{2} * x_{2} + \beta_{3} * x_{1} * x_{2}\)</span></font></p>
<p>This is easier to understand by looking at the interaction of a continuous and a binary variable:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fl">1.7</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction is added as the product</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># of x1 and x2</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> b3 <span class="sc">*</span> x1 <span class="sc">*</span> x2 <span class="sc">+</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    error</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>xy_data_intr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_intr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">x1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">x2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">b</td>
<td style="text-align: center;">1.0256</td>
<td style="text-align: center;">-4.0147</td>
</tr>
<tr class="even">
<td style="text-align: center;">a</td>
<td style="text-align: center;">-0.2848</td>
<td style="text-align: center;">-5.1746</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">-1.2207</td>
<td style="text-align: center;">-1.3991</td>
</tr>
<tr class="even">
<td style="text-align: center;">b</td>
<td style="text-align: center;">0.1813</td>
<td style="text-align: center;">-1.0242</td>
</tr>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">-0.1389</td>
<td style="text-align: center;">-3.8483</td>
</tr>
<tr class="even">
<td style="text-align: center;">b</td>
<td style="text-align: center;">0.0058</td>
<td style="text-align: center;">4.1377</td>
</tr>
</tbody>
</table>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>xy_mod_intr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    x1 <span class="sc">*</span> x2, <span class="at">data =</span> xy_data_intr)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary to make best fit lines</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>xy_summ_intr <span class="ot">&lt;-</span> <span class="fu">summary</span>(xy_mod_intr)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>xy_summ_intr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2 + x1 * x2, data = xy_data_intr)

Residuals:
   Min     1Q Median     3Q    Max 
-6.222 -1.664 -0.158  1.650  6.383 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -4.193      0.570   -7.35  2.7e-09 ***
x1b            3.597      0.806    4.46  5.2e-05 ***
x2             1.327      0.682    1.95   0.0576 .  
x1b:x2        -2.972      0.962   -3.09   0.0034 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.83 on 46 degrees of freedom
Multiple R-squared:  0.396, Adjusted R-squared:  0.357 
F-statistic:   10 on 3 and 46 DF,  p-value: 3.29e-05</code></pre>
</div>
</div>
<p>It also helps to plot the data (don’t worry too much about all the code):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_intr, <span class="fu">aes</span>(<span class="at">x =</span> x2, <span class="at">y =</span> y,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> x1)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>… and the effect sizes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_intr<span class="sc">$</span>coefficients),</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">est =</span> xy_mod_intr<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_intr))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>..,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We should also check the diagnostic plots:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(xy_mod_intr, <span class="at">type =</span> <span class="st">"diag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-57-3.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-57-4.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value   Pr(&gt;|t|)
(Intercept)  -4.1930    0.57023 -7.3532 2.6978e-09
x1b           3.5974    0.80607  4.4629 5.1950e-05
x2            1.3274    0.68161  1.9474 5.7610e-02
x1b:x2       -2.9720    0.96227 -3.0885 3.4061e-03</code></pre>
</div>
</div>
<ul>
<li><p>The model found that <span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1-b’ to ‘x1-a’) is 3.59741 and that it is significantly different from 0 (p-value = 5.19496^{-5})</p></li>
<li><p>The model found that <span class="math inline">\(\beta_2\)</span> (the effect size of ‘x2’) is 1.32735 and that it is significantly different from 0 (p-value = 0.05761). This is actually the slope of the relation between x2 and y when x1 = ‘a’</p></li>
<li><p>The model found that <span class="math inline">\(\beta_3\)</span> (the effect size of the interaction term ‘x1 * x2’) is -2.97196 and that it is significantly different from 0 (p-value = 0.00341). This is the difference between the slopes of x2 <em>vs</em> y when x1 = ‘a’ and x2 <em>vs</em> y when x1 = ‘b’.</p></li>
<li><p>The simulated values for the regression parameters can be compared to the summary of the <code>lm()</code> model to get a sense of the model precision:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> was set to 3 and was estimated as 3.597</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> was set to 1.7 and was estimated as 1.327</p></li>
<li><p><span class="math inline">\(\beta_3\)</span> was set to -3 and was estimated as -2.972</p></li>
</ul></li>
</ul>
</div>
<hr>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<ul>
<li>Chirino F, B Wilink, Araya-Salas M. In prep. <strong>Climatic factors affecting vocal activity in lemur leaf frogs</strong>.</li>
</ul>
<p>“<em>Increased moonlight decreases the vocal activity of </em>Agalychnis lemur* although this relationship is mediated by temperature*.”</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/lemur.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li><p>Modified the <a href="#simulating-an-associated-predictor">code use to simulate a single associated predictor</a> by gradually increasing the error. This is done by increasing the ‘sd’ argument in <code>error &lt;- rnorm(n = n, sd = 2)</code></p></li>
<li><p>Take a look at how larger errors affect inference (so you also need to run the models)</p></li>
</ul>
<ul>
<li>Now replace the error term with <code>error &lt;- rexp(n = n, rate = 0.2)</code>. This is creating an error with an exponential distribution (so non-normal). This is supposed to be problematic for the inferential power of these models. Compare the estimates you got to the simulation values (‘b0’ and ‘b1’). Explore the distribution of residuals (<code>plot_model(model_name, type = "diag")</code>) for both ‘normal’ and ‘exponential’ error models.</li>
</ul>
<ul>
<li>Collinearity (the presence of correlated predictors) is supposed to affect the stability of multiple regression. The following code creates two highly collinear predictors (‘x1’ and ‘x2’). The last line of code shows the correlation between them.</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make x2 very similar to x2 (adding</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># little variation)</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x1, x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.94642</code></pre>
</div>
</div>
<ul>
<li><p>Build a multiple regression model for this data (y ~ x1 + x2). You can use the same code as in the section <a href="#adding-more-than-1-predictor-multiple-regression">Adding more than 1 predictor: multiple regression</a>.</p></li>
<li><p>How is the inference affected by the presence of collinear predictors? Make the diagnostic plots for this model (<code>plot(model_name)</code>).</p></li>
<li><p>Simulate a data set with three predictors in which only two of them are highly collinear. Fit a multiple regression model (y ~ x1 + x2 + x3) for that data and look at how collinearity affects the estimate for the non-collinear predictor.</p></li>
</ul>
</div>
<hr>
</section>
</section>
<section id="extending-the-linear-models-to-more-complex-data-structures" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Extending the linear models to more complex data structures</h1>
<section id="generalized-linear-models" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="generalized-linear-models"><span class="header-section-number">4.1</span> Generalized linear models</h2>
<p>GLM’s allow us to model the association to response variables that do not fit to a normal distribution. Furthermore, they allow to model distributions that more closely resemble the process that generated the data. The following data set creates a data set with a response representing counts (so non-normal):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sample size</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># regression coefficients</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># generate variables</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n, <span class="at">lambda =</span> <span class="fl">6.5</span>)  <span class="co"># lambda = average rate of success</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, , <span class="fu">length</span>(y))</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(y) <span class="sc">-</span> b0 <span class="sc">-</span> b2 <span class="sc">*</span> x2)<span class="sc">/</span>b1</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>xy_data_pois <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_pois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">x1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">x2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.1433</td>
<td style="text-align: center;">-0.5000</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.5738</td>
<td style="text-align: center;">-0.4796</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.5738</td>
<td style="text-align: center;">-0.4592</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.5738</td>
<td style="text-align: center;">-0.4388</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.7671</td>
<td style="text-align: center;">-0.4184</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.5738</td>
<td style="text-align: center;">-0.3980</td>
<td style="text-align: center;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let also plot ‘x1’ <em>vs</em> ‘y’:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data_pois, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()  <span class="co"># plot points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The relation does not seem very linear nor the variance seems to be constant across ‘x1’.</p>
<p>We can relaxed the normal distribution requirement with GLMs. <code>glm()</code> is a base R function that help us do the trick. For this example the most appropriate distribution is <em>Poisson</em>. This can be set in the ‘family’ argument like this:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>glm_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_data_pois,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As you can see the only extra argument compared to <code>lm()</code> is ‘family’. The rest is just the ‘formula’ and ‘data’ we are already familiar with. So again, we can build upon of our knowledge on linear models to extend them to more complex data structures.</p>
<p>We also need to run <code>summary()</code> to get model output:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_pois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ x1 + x2, family = poisson(), data = xy_data_pois)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 1.20e+00   1.29e-01    9.31  &lt; 2e-16 ***
x1          1.30e+00   2.20e-01    5.92  3.2e-09 ***
x2          1.39e-16   1.90e-01    0.00        1    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 3.9471e+01  on 49  degrees of freedom
Residual deviance: 2.2204e-16  on 47  degrees of freedom
AIC: 186.9

Number of Fisher Scoring iterations: 3</code></pre>
</div>
</div>
<div class="alert alert-success">
<p><font size="5"><b>Model interpretation</b></font></p>
<p>Coefficients table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error    z value   Pr(&gt;|z|)
(Intercept) 1.2000e+00    0.12889 9.3106e+00 1.2709e-20
x1          1.3000e+00    0.21960 5.9200e+00 3.2198e-09
x2          1.3882e-16    0.19016 7.3003e-16 1.0000e+00</code></pre>
</div>
</div>
<ul>
<li><p>The model tells us that <span class="math inline">\(\beta_1\)</span> (the effect size of ‘x1’) is 1.3 and that it is significantly different from 0 (p-value = 3.21981^{-9}). This is actually interpreted as an increase in 1 unit of ‘x1’ results in ‘y’ (rate) by a factor of exp(1.3) = 3.6693.</p></li>
<li><p>The model also tells us that <span class="math inline">\(\beta_2\)</span> (the effect size of ‘x2’) is 1.38824^{-16} and that it is significantly different from 0 (p-value = 1). This is means that an increase in 1 unit of ‘x2’ results in ‘y’ (rate) by a factor of exp(1.38824^{-16}) = 1.</p></li>
</ul>
</div>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li>Try fitting a <code>lm()</code> model (so with a gaussian distribution), compare the results and check the residuals (<code>plot_model(model_name, type = "diag")</code>)</li>
</ul>
</div>
<p>Many other distribution and link functions are available:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/link-functions.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="mixed-effect-models" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="mixed-effect-models"><span class="header-section-number">4.2</span> Mixed-effect models</h2>
<p>Sometimes our data sets include additional levels of structure. For instance, when we sample several individuals from different populations. In those cases variation at the higher structural level (populations) might preclude detecting patterns at the lower level (individuals).</p>
<p>Let’s simulate some data that resembles that scenario. We have two continuous predictor (x1) and a continuous response (y). Each sample comes from 1 of 8 different populations (pops):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x&lt;- 1 set seed</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">28</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> pops <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co"># add letters</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> letters[pops <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># create data set</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>xy_data_pops <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y, pops)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_pops, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">x1</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">y</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">pops</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1.5461</td>
<td style="text-align: center;">3.3378</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.5683</td>
<td style="text-align: center;">3.1400</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.6385</td>
<td style="text-align: center;">15.2824</td>
<td style="text-align: center;">i</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.9842</td>
<td style="text-align: center;">2.6610</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.0536</td>
<td style="text-align: center;">3.7312</td>
<td style="text-align: center;">b</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.8229</td>
<td style="text-align: center;">3.0189</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-1.3237</td>
<td style="text-align: center;">3.2186</td>
<td style="text-align: center;">c</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.1785</td>
<td style="text-align: center;">19.0542</td>
<td style="text-align: center;">i</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2.2648</td>
<td style="text-align: center;">15.4549</td>
<td style="text-align: center;">i</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.7784</td>
<td style="text-align: center;">11.6670</td>
<td style="text-align: center;">h</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can explore the relation between y and x1 with a plot:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_pops, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>can you clearly see the pattern of association between the two variables we used to simulate the data? We can further explore the data with a simple linear regression model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data_pops))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1, data = xy_data_pops)

Residuals:
    Min      1Q  Median      3Q     Max 
-11.755  -5.119   0.186   4.602  12.409 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    8.852      0.325   27.21   &lt;2e-16 ***
x1             0.633      0.329    1.92    0.055 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.63 on 298 degrees of freedom
Multiple R-squared:  0.0123,    Adjusted R-squared:  0.00895 
F-statistic:  3.7 on 1 and 298 DF,  p-value: 0.0554</code></pre>
</div>
</div>
<p>Despite having simulated a non-zero <span class="math inline">\(\beta_1\)</span> we have no significant association according to this model and the estimated for <span class="math inline">\(\beta_1\)</span> is far from the simulated one. This poor inference is due to the fact that we are ignoring an important feature of our data, the grouping of samples in ‘populations’.</p>
<p>Mixed-effect models (a.k.a. multi-level models or varying effect models) can help us account for these additional features, significantly improving our inferential power. Let’s color each of the populations to see how the variables co-vary for each data sub-group:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_pops, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> pops)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There seems to be a clear pattern of positive association between x1 and y. The pattern becomes a bit more obvious if we plot each population in its own panel:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_pops, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> pops)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>pops) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_regression_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Let’s build a mixed-effect model using population as a varying intercept:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mix_eff_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    pops))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mix_eff_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: y ~ x1 + (1 | pops)

REML criterion at convergence: 1296.4

Scaled residuals: 
   Min     1Q Median     3Q    Max 
-3.524 -0.657 -0.032  0.612  3.245 

Random effects:
 Groups   Name        Variance Std.Dev.
 pops     (Intercept) 30.07    5.48    
 Residual              3.76    1.94    
Number of obs: 300, groups:  pops, 9

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)    8.788      1.831   8.003     4.8   0.0014 ** 
x1             1.317      0.115 290.068    11.4   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
   (Intr)
x1 -0.003</code></pre>
</div>
</div>
<p>The model correctly detected the simulated pattern and the estimate for <span class="math inline">\(\beta_1\)</span> (1.31665) is very close to the simulated value.</p>
<hr>
</section>
<section id="references" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="references"><span class="header-section-number">4.3</span> References</h2>
<ul>
<li><p><a href="https://github.com/rmcelreath/stat_rethinking_2022">Richard McElreath’s Statistical Rethinking book</a></p></li>
<li><p><a href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rbinom/">R’s rbinom – Simulate Binomial or Bernoulli trials</a></p></li>
<li><p><a href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rnorm/">R’s rnorm – selecting values from a normal distribution</a></p></li>
<li><p><a href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/rexp/">R’s exp – Simulating Exponential Distributions</a></p></li>
<li><p><a href="https://aosmith.rbind.io/2018/08/29/getting-started-simulating-data/">Simulating data in R</a></p></li>
</ul>
<hr>
</section>
</section>
<section id="session-information" class="level1 unnumbered unlisted">
<h1 class="unnumbered unlisted">Session information</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.2 (2023-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.2 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

time zone: America/Costa_Rica
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] sjPlot_2.8.15     lmerTest_3.1-3    lme4_1.1-35.3     Matrix_1.6-5     
[5] viridis_0.6.5     viridisLite_0.4.2 ggplot2_3.5.1     knitr_1.48       
[9] kableExtra_1.4.0 

loaded via a namespace (and not attached):
 [1] sjlabelled_1.2.0    tidyselect_1.2.1    farver_2.1.2       
 [4] dplyr_1.1.4         fastmap_1.2.0       TH.data_1.1-2      
 [7] bayestestR_0.13.1   sjstats_0.18.2      digest_0.6.37      
[10] estimability_1.4.1  lifecycle_1.0.4     survival_3.2-13    
[13] magrittr_2.0.3      compiler_4.3.2      rlang_1.1.4        
[16] tools_4.3.2         utf8_1.2.4          yaml_2.3.10        
[19] labeling_0.4.3      htmlwidgets_1.6.4   xml2_1.3.6         
[22] abind_1.4-5         multcomp_1.4-25     withr_3.0.1        
[25] purrr_1.0.2         numDeriv_2016.8-1.1 grid_4.3.2         
[28] fansi_1.0.6         xtable_1.8-4        colorspace_2.1-1   
[31] emmeans_1.9.0       scales_1.3.0        MASS_7.3-55        
[34] insight_0.19.11     cli_3.6.3           mvtnorm_1.2-5      
[37] rmarkdown_2.28      generics_0.1.3      rstudioapi_0.16.0  
[40] performance_0.10.8  modelr_0.1.11       minqa_1.2.7        
[43] stringr_1.5.1       splines_4.3.2       formatR_1.14       
[46] vctrs_0.6.5         boot_1.3-28         sandwich_3.1-0     
[49] carData_3.0-5       jsonlite_1.8.8      car_3.1-2          
[52] systemfonts_1.1.0   tidyr_1.3.1         glue_1.7.0         
[55] nloptr_2.0.3        codetools_0.2-18    stringi_1.8.4      
[58] gtable_0.3.5        ggeffects_1.3.4     munsell_0.5.1      
[61] tibble_3.2.1        pillar_1.9.0        htmltools_0.5.8.1  
[64] R6_2.5.1            evaluate_0.24.0     lattice_0.20-45    
[67] highr_0.11          backports_1.5.0     broom_1.0.5        
[70] Rcpp_1.0.13         svglite_2.1.3       coda_0.19-4.1      
[73] gridExtra_2.3       nlme_3.1-155        mgcv_1.8-39        
[76] xfun_0.47           zoo_1.8-12          sjmisc_2.8.9       
[79] pkgconfig_2.0.3    </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/marce10\.github\.io\/OTS_TBCP_2024\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb94" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &lt;font size="7"&gt;&lt;b&gt;Linear regression models&lt;/b&gt;&lt;/font&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,echo=FALSE,message=FALSE}</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="in">options("digits"=5)</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="in">options("digits.secs"=3)</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="in"># options to customize chunk outputs</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="in"> )</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-info}</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># Objectives {.unnumbered .unlisted}</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand statistical inference through a single modelling tool (broad sense linear models)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Get familiar with building linear models</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extent linear models to different data structures</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE, message=FALSE}</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="in">library(viridis)</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a><span class="in">library(lmerTest)</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(sjPlot)</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="in">tibble &lt;- function(x, ...) { </span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- kbl(x, digits=4, align= 'c', row.names = FALSE) </span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="in">   x &lt;- kable_styling(x, position ="center", full_width = FALSE,  bootstrap_options = c("striped", "hover", "condensed", "responsive")) </span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="in">   asis_output(x)</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="in">registerS3method("knit_print", "data.frame", tibble)</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot settings</span></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a><span class="in">geom_histogram &lt;- function(...) ggplot2::geom_histogram(..., fill = viridis(10, alpha = 0.5)[8], show.legend = FALSE, bins = 20, color = "black")</span></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a><span class="in">geom_smooth &lt;- function(...) ggplot2::geom_smooth(..., color = viridis(10,  alpha = 0.5)[8])</span></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a><span class="in">geom_boxplot &lt;- function(...) ggplot2::geom_boxplot(..., fill = viridis(10, alpha = 0.5)[7])</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a><span class="in">geom_pointrange &lt;- function(...) ggplot2::geom_pointrange(..., show.legend = FALSE, color = viridis(10, alpha = 0.5)[7], size = 2) </span></span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model &lt;- function(...) sjPlot::plot_model(xy_mod, type = "diag", colors = viridis(10, alpha = 0.5)[7])</span></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a><span class="in">theme_set(theme_classic(base_size = 20))</span></span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy.opts = list(width.cutoff = 40), </span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy = TRUE,</span></span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE</span></span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a><span class="in"> )</span></span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># Linear models as a unifying framework</span></span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>Traditionally, statistical models have been taught as disconnected tools with no clear relationship between them. Take a look at a classic biology stats book (Sokal &amp; Rolhf):</span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/sokal_rohlf.png")</span></span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>However, most of those common statistical models are just special cases of linear models. Hence, learning them as such can largely simplify things. This approach has several advantages: </span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First of all, **it all comes down to *y=a⋅x+b***, which largely simplify learning</span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This also means that there is **no need to learn about parameters, assumptions, and result interpretation for every single special case**</span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear models have been extended to **account for complex distributions and data structures** (e.g. mixed models, generalized linear models, zero-inflated models, etc) providing a **more flexible platform**. </span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear models are **applied across statistical paradigms** (e.g. frequentist, bayesian)</span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a>Please load the following packages:</span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a><span class="in">library(viridis)</span></span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a><span class="in">library(lmerTest)</span></span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a><span class="in">library(sjPlot)</span></span>
<span id="cb94-99"><a href="#cb94-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-100"><a href="#cb94-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-102"><a href="#cb94-102" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-warning}</span>
<span id="cb94-103"><a href="#cb94-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-104"><a href="#cb94-104" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simple linear regression</span></span>
<span id="cb94-105"><a href="#cb94-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-106"><a href="#cb94-106" aria-hidden="true" tabindex="-1"></a>Linear regressions are based on the linear equation *a = mx + b* we learned in high school. The formal representation looks like this:</span>
<span id="cb94-107"><a href="#cb94-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-108"><a href="#cb94-108" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}$&lt;/font&gt;</span>
<span id="cb94-109"><a href="#cb94-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-110"><a href="#cb94-110" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-111"><a href="#cb94-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-112"><a href="#cb94-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\hat{Y}$: response variable</span>
<span id="cb94-113"><a href="#cb94-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-114"><a href="#cb94-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_{o}$: intercept (y value)</span>
<span id="cb94-115"><a href="#cb94-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-116"><a href="#cb94-116" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_{1}$: estimate of the magnitude of the effect of $x_{1}$ on $\hat{Y}$ (a.k.a. effect size, coefficient or simply the 'estimate')</span>
<span id="cb94-117"><a href="#cb94-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-118"><a href="#cb94-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$x_{1}$: predictor variable</span>
<span id="cb94-119"><a href="#cb94-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-120"><a href="#cb94-120" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-121"><a href="#cb94-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-122"><a href="#cb94-122" aria-hidden="true" tabindex="-1"></a>The most common goal of a linear regression is estimating the $\beta_{*}$ values. This is achieved by finding the best fitting straight line representing the association between a predictor and the response:</span>
<span id="cb94-123"><a href="#cb94-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-124"><a href="#cb94-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-125"><a href="#cb94-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-126"><a href="#cb94-126" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/regression-2.jpg")</span></span>
<span id="cb94-127"><a href="#cb94-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-128"><a href="#cb94-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-129"><a href="#cb94-129" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-130"><a href="#cb94-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-131"><a href="#cb94-131" aria-hidden="true" tabindex="-1"></a>Those $\beta_{*}$s are the estimated effect size of the correspondent predictor (e.g. $\beta_{1}$ is the effect size $x_{1}$). Their value represent the mean change in $\hat{Y}$ (in $\hat{Y}$ units) for a unit of change in $\beta_{*}$.  Hence the null hypothesis is that those $\beta_{*}$s are not different from 0:</span>
<span id="cb94-132"><a href="#cb94-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-133"><a href="#cb94-133" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\qquad \mathcal{H}_0: \hat{Y} = \beta_0 + 0 * x_{1}$&lt;/font&gt;</span>
<span id="cb94-134"><a href="#cb94-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-135"><a href="#cb94-135" aria-hidden="true" tabindex="-1"></a>which is equivalent to this:</span>
<span id="cb94-136"><a href="#cb94-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-137"><a href="#cb94-137" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\qquad \mathcal{H}_0: \hat{Y} = \beta_0$&lt;/font&gt;</span>
<span id="cb94-138"><a href="#cb94-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-139"><a href="#cb94-139" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-140"><a href="#cb94-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-141"><a href="#cb94-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE, eval = FALSE}</span></span>
<span id="cb94-142"><a href="#cb94-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-143"><a href="#cb94-143" aria-hidden="true" tabindex="-1"></a><span class="in"># For instance, a regression model with this output:</span></span>
<span id="cb94-144"><a href="#cb94-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-145"><a href="#cb94-145" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb94-146"><a href="#cb94-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-147"><a href="#cb94-147" aria-hidden="true" tabindex="-1"></a><span class="in"># number of observations</span></span>
<span id="cb94-148"><a href="#cb94-148" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 50</span></span>
<span id="cb94-149"><a href="#cb94-149" aria-hidden="true" tabindex="-1"></a><span class="in">b0 &lt;- 1</span></span>
<span id="cb94-150"><a href="#cb94-150" aria-hidden="true" tabindex="-1"></a><span class="in">b1 &lt;- 3</span></span>
<span id="cb94-151"><a href="#cb94-151" aria-hidden="true" tabindex="-1"></a><span class="in">error &lt;- rnorm(n = n, sd = 2)</span></span>
<span id="cb94-152"><a href="#cb94-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-153"><a href="#cb94-153" aria-hidden="true" tabindex="-1"></a><span class="in"># random variables</span></span>
<span id="cb94-154"><a href="#cb94-154" aria-hidden="true" tabindex="-1"></a><span class="in">B1 &lt;-  rnorm(n = n, mean = 0, sd = 1)</span></span>
<span id="cb94-155"><a href="#cb94-155" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- b0 + b1 * B1 + error</span></span>
<span id="cb94-156"><a href="#cb94-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-157"><a href="#cb94-157" aria-hidden="true" tabindex="-1"></a><span class="in"># create data frame</span></span>
<span id="cb94-158"><a href="#cb94-158" aria-hidden="true" tabindex="-1"></a><span class="in">xy_data &lt;- data.frame(B1, y)</span></span>
<span id="cb94-159"><a href="#cb94-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-160"><a href="#cb94-160" aria-hidden="true" tabindex="-1"></a><span class="in"># build model</span></span>
<span id="cb94-161"><a href="#cb94-161" aria-hidden="true" tabindex="-1"></a><span class="in">xy_mod &lt;- lm(formula = y ~ B1, data = xy_data)</span></span>
<span id="cb94-162"><a href="#cb94-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-163"><a href="#cb94-163" aria-hidden="true" tabindex="-1"></a><span class="in">summary(xy_mod)$coefficients</span></span>
<span id="cb94-164"><a href="#cb94-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-165"><a href="#cb94-165" aria-hidden="true" tabindex="-1"></a><span class="in"># Results in the following predictive model:</span></span>
<span id="cb94-166"><a href="#cb94-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-167"><a href="#cb94-167" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;font size = 6&gt;$\hat{Y} \sim 1.079 + 2.926 * x_{1}$&lt;/font&gt;</span></span>
<span id="cb94-168"><a href="#cb94-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-169"><a href="#cb94-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-170"><a href="#cb94-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-171"><a href="#cb94-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-172"><a href="#cb94-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-173"><a href="#cb94-173" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/model_betas.png")</span></span>
<span id="cb94-174"><a href="#cb94-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-175"><a href="#cb94-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-176"><a href="#cb94-176" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb94-177"><a href="#cb94-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-178"><a href="#cb94-178" aria-hidden="true" tabindex="-1"></a><span class="fu"># Linear regression in R</span></span>
<span id="cb94-179"><a href="#cb94-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-180"><a href="#cb94-180" aria-hidden="true" tabindex="-1"></a>To take full advantage of linear models we need to feel comfortable with them. We will do this by exploring R's linear regression function <span class="in">`lm()`</span>. In R most linear models and their extensions share common data input and output formats which makes easy to apply them once we understand their basics. </span>
<span id="cb94-181"><a href="#cb94-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-182"><a href="#cb94-182" aria-hidden="true" tabindex="-1"></a>We will use the data set 'trees' that comes by default with R. 'trees' provides measurements of the **diameter** (labeled as 'Girth'), **height** and **volume** of 31 felled black cherry trees: </span>
<span id="cb94-183"><a href="#cb94-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-186"><a href="#cb94-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-187"><a href="#cb94-187" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trees)</span>
<span id="cb94-188"><a href="#cb94-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-189"><a href="#cb94-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-190"><a href="#cb94-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-191"><a href="#cb94-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-192"><a href="#cb94-192" aria-hidden="true" tabindex="-1"></a>The basic R function to build a linear model is <span class="in">`lm()`</span>. Let's look at the basic components of a regression model using <span class="in">`lm()`</span>:</span>
<span id="cb94-193"><a href="#cb94-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-194"><a href="#cb94-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-195"><a href="#cb94-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-196"><a href="#cb94-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-197"><a href="#cb94-197" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/lm2.png")</span></span>
<span id="cb94-198"><a href="#cb94-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-199"><a href="#cb94-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-200"><a href="#cb94-200" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-201"><a href="#cb94-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-202"><a href="#cb94-202" aria-hidden="true" tabindex="-1"></a>We can fit this model to look at the output:</span>
<span id="cb94-205"><a href="#cb94-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-206"><a href="#cb94-206" aria-hidden="true" tabindex="-1"></a>reg_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Height <span class="sc">~</span> Girth, <span class="at">data =</span> trees)</span>
<span id="cb94-207"><a href="#cb94-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-208"><a href="#cb94-208" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_mod)</span>
<span id="cb94-209"><a href="#cb94-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-210"><a href="#cb94-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-211"><a href="#cb94-211" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-212"><a href="#cb94-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-213"><a href="#cb94-213" aria-hidden="true" tabindex="-1"></a>This is what the elements of the output mean:</span>
<span id="cb94-214"><a href="#cb94-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-215"><a href="#cb94-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Call**: the function and parameters were used to create the model</span>
<span id="cb94-216"><a href="#cb94-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-217"><a href="#cb94-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Residuals**: distribution of the residuals. Residuals are the difference between what the model predicted and the actual value of y. This is a graphic representation of the residuals:</span>
<span id="cb94-218"><a href="#cb94-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-219"><a href="#cb94-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb94-220"><a href="#cb94-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-221"><a href="#cb94-221" aria-hidden="true" tabindex="-1"></a><span class="in"># add predicted values for plotting</span></span>
<span id="cb94-222"><a href="#cb94-222" aria-hidden="true" tabindex="-1"></a><span class="in">trees$predicted &lt;- reg_mod$fitted.values</span></span>
<span id="cb94-223"><a href="#cb94-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-224"><a href="#cb94-224" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb94-225"><a href="#cb94-225" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(trees, aes(x = Girth, y = Height)) + </span></span>
<span id="cb94-226"><a href="#cb94-226" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE) +  </span></span>
<span id="cb94-227"><a href="#cb94-227" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_segment(aes(xend = Girth, yend = predicted), alpha = .2) +</span></span>
<span id="cb94-228"><a href="#cb94-228" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb94-229"><a href="#cb94-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-230"><a href="#cb94-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-231"><a href="#cb94-231" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-232"><a href="#cb94-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-233"><a href="#cb94-233" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Coefficients**: this one contains the effect sizes ('Estimates'), a measure of their uncertainty ('Std. Error'), the associated statistic ('t value') and p value ('Pr(&gt;|t|)'). Estimates are given as the mean change in y for every increase in 1 unit in x. So for this example is 1.0544 $in / in$. Despite the fact that the units will cancel out (`1.0544 $in / in$ = 1.0544) keeping them in mind is still biologically meaningful. They mean that, in average, and 1 inch increase in girth you will expect an increase of 1.0544 inches in height. </span>
<span id="cb94-234"><a href="#cb94-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-235"><a href="#cb94-235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Residual standard error**: self-explanatory. The standard error of the residuals</span>
<span id="cb94-236"><a href="#cb94-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-237"><a href="#cb94-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multiple R-squared**: the coefficient of determination, this is intended as a measurement of how well your model fits to the data</span>
<span id="cb94-238"><a href="#cb94-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-239"><a href="#cb94-239" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adjusted R-Squared**: similar to the 'Multiple R-squared' but penalized for the number of parameters</span>
<span id="cb94-240"><a href="#cb94-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-241"><a href="#cb94-241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**F-statistic**: statistic for a global test that checks if at least one of your coefficients are non-zero</span>
<span id="cb94-242"><a href="#cb94-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-243"><a href="#cb94-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**p-value**: probability for a global test that checks if at least one of your coefficients are non-zero</span>
<span id="cb94-244"><a href="#cb94-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-245"><a href="#cb94-245" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-246"><a href="#cb94-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-247"><a href="#cb94-247" aria-hidden="true" tabindex="-1"></a>We will use <span class="in">`lm()`</span> to showcase the flexibility of regression models. Regression components will be added gradually so we can take time of understand each of them as well as the correspondent changes in the regression output.</span>
<span id="cb94-248"><a href="#cb94-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-249"><a href="#cb94-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-250"><a href="#cb94-250" aria-hidden="true" tabindex="-1"></a><span class="fu">## Response (intercept)-only model</span></span>
<span id="cb94-251"><a href="#cb94-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-252"><a href="#cb94-252" aria-hidden="true" tabindex="-1"></a>Let's first create a response numeric variable:</span>
<span id="cb94-253"><a href="#cb94-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-256"><a href="#cb94-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-257"><a href="#cb94-257" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-258"><a href="#cb94-258" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-259"><a href="#cb94-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-260"><a href="#cb94-260" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-261"><a href="#cb94-261" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-262"><a href="#cb94-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-263"><a href="#cb94-263" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-264"><a href="#cb94-264" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-265"><a href="#cb94-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-266"><a href="#cb94-266" aria-hidden="true" tabindex="-1"></a><span class="co"># put it in a data frame</span></span>
<span id="cb94-267"><a href="#cb94-267" aria-hidden="true" tabindex="-1"></a>y_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y)</span>
<span id="cb94-268"><a href="#cb94-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-269"><a href="#cb94-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-270"><a href="#cb94-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-271"><a href="#cb94-271" aria-hidden="true" tabindex="-1"></a>This single variable can be input in an **intercept-only regression model**. To do this we need to supply the model formula and the data to <span class="in">`lm()`</span>:</span>
<span id="cb94-272"><a href="#cb94-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-275"><a href="#cb94-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-276"><a href="#cb94-276" aria-hidden="true" tabindex="-1"></a><span class="co"># run model</span></span>
<span id="cb94-277"><a href="#cb94-277" aria-hidden="true" tabindex="-1"></a>y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> y_data)</span>
<span id="cb94-278"><a href="#cb94-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-279"><a href="#cb94-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-280"><a href="#cb94-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-281"><a href="#cb94-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-282"><a href="#cb94-282" aria-hidden="true" tabindex="-1"></a>Which is equivalent to:</span>
<span id="cb94-283"><a href="#cb94-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-284"><a href="#cb94-284" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o}$&lt;/font&gt;</span>
<span id="cb94-285"><a href="#cb94-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-286"><a href="#cb94-286" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-287"><a href="#cb94-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-288"><a href="#cb94-288" aria-hidden="true" tabindex="-1"></a>We can get the default summary of the model results by running <span class="in">`summary()`</span> on the output object 'y_mod':</span>
<span id="cb94-289"><a href="#cb94-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-292"><a href="#cb94-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-293"><a href="#cb94-293" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y_mod)</span>
<span id="cb94-294"><a href="#cb94-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-295"><a href="#cb94-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-296"><a href="#cb94-296" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-297"><a href="#cb94-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-298"><a href="#cb94-298" aria-hidden="true" tabindex="-1"></a>It can be quite informative to plot the effect sizes (although in this case we just have one):</span>
<span id="cb94-301"><a href="#cb94-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-302"><a href="#cb94-302" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(y_mod<span class="sc">$</span>coefficients), </span>
<span id="cb94-303"><a href="#cb94-303" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> y_mod<span class="sc">$</span>coefficients, <span class="fu">confint</span>(y_mod))</span>
<span id="cb94-304"><a href="#cb94-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-305"><a href="#cb94-305" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-306"><a href="#cb94-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-307"><a href="#cb94-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-308"><a href="#cb94-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-309"><a href="#cb94-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-310"><a href="#cb94-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-311"><a href="#cb94-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-312"><a href="#cb94-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-313"><a href="#cb94-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-314"><a href="#cb94-314" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-315"><a href="#cb94-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-316"><a href="#cb94-316" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-317"><a href="#cb94-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-318"><a href="#cb94-318" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-319"><a href="#cb94-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-320"><a href="#cb94-320" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-321"><a href="#cb94-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-322"><a href="#cb94-322" aria-hidden="true" tabindex="-1"></a>For assessing the significance of the association we focus on the coefficients table:</span>
<span id="cb94-323"><a href="#cb94-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-324"><a href="#cb94-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-325"><a href="#cb94-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-326"><a href="#cb94-326" aria-hidden="true" tabindex="-1"></a><span class="in">summ_y_mod &lt;- summary(y_mod)</span></span>
<span id="cb94-327"><a href="#cb94-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-328"><a href="#cb94-328" aria-hidden="true" tabindex="-1"></a><span class="in">summ_y_mod$coefficients</span></span>
<span id="cb94-329"><a href="#cb94-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-330"><a href="#cb94-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-331"><a href="#cb94-331" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this example there are no predictors in the model so we only got an estimate for the intercept ($\beta_0$)</span>
<span id="cb94-332"><a href="#cb94-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-333"><a href="#cb94-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model tell us that the intercept is estimated at <span class="in">`r summ_y_mod$coefficients[1, 1]`</span> and that this value is not significantly different from 0 (p-value = <span class="in">`r summ_y_mod$coefficients[1, 4]`</span>)</span>
<span id="cb94-334"><a href="#cb94-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-335"><a href="#cb94-335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this case the intercept is simply the mean of the response variable</span>
<span id="cb94-336"><a href="#cb94-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-339"><a href="#cb94-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-340"><a href="#cb94-340" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y_data<span class="sc">$</span>y)</span>
<span id="cb94-341"><a href="#cb94-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-342"><a href="#cb94-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-343"><a href="#cb94-343" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-344"><a href="#cb94-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-345"><a href="#cb94-345" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We seldom have predictions about the intercept so we tend to ignore this estimate.</span>
<span id="cb94-346"><a href="#cb94-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-347"><a href="#cb94-347" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-348"><a href="#cb94-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-349"><a href="#cb94-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-350"><a href="#cb94-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-351"><a href="#cb94-351" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-352"><a href="#cb94-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-353"><a href="#cb94-353" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;font size="5"&gt;&lt;b&gt;Case study&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</span>
<span id="cb94-354"><a href="#cb94-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-355"><a href="#cb94-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-356"><a href="#cb94-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-357"><a href="#cb94-357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ruhs, E. C., Martin, L. B., &amp; Downs, C. J. (2020). <span class="co">[</span><span class="ot">**The impacts of body mass on immune cell concentrations in birds**</span><span class="co">](https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.0655?download=true)</span>. *Proceedings of the Royal Society B*, 287(1934), 20200655.</span>
<span id="cb94-358"><a href="#cb94-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-359"><a href="#cb94-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-360"><a href="#cb94-360" aria-hidden="true" tabindex="-1"></a>"*We found that an intercept-only model best explained lymphocyte and eosinophil concentrations in birds, indicating that concentrations of these cell types were independent of body mass.*"</span>
<span id="cb94-361"><a href="#cb94-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-362"><a href="#cb94-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-363"><a href="#cb94-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "85%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-364"><a href="#cb94-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-365"><a href="#cb94-365" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/leukocytes.png")</span></span>
<span id="cb94-366"><a href="#cb94-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-367"><a href="#cb94-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-368"><a href="#cb94-368" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-369"><a href="#cb94-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-370"><a href="#cb94-370" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-371"><a href="#cb94-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-372"><a href="#cb94-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-373"><a href="#cb94-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-374"><a href="#cb94-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-375"><a href="#cb94-375" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-376"><a href="#cb94-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-377"><a href="#cb94-377" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-378"><a href="#cb94-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-379"><a href="#cb94-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-380"><a href="#cb94-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-381"><a href="#cb94-381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Change the <span class="in">`mean`</span> argument in the <span class="in">`rnorm()`</span> function call to a value other than 0 and look at how things change in the coefficients table </span>
<span id="cb94-382"><a href="#cb94-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-383"><a href="#cb94-383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Change the <span class="in">`sd`</span> argument in the <span class="in">`rnorm()`</span> function call to a higher value and look at how things change in the coefficients table </span>
<span id="cb94-384"><a href="#cb94-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-385"><a href="#cb94-385" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-386"><a href="#cb94-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-387"><a href="#cb94-387" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-388"><a href="#cb94-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-389"><a href="#cb94-389" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-390"><a href="#cb94-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-391"><a href="#cb94-391" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adding a non-associated predictor</span></span>
<span id="cb94-392"><a href="#cb94-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-393"><a href="#cb94-393" aria-hidden="true" tabindex="-1"></a>We can create 2 unrelated numeric variables like this:</span>
<span id="cb94-394"><a href="#cb94-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-397"><a href="#cb94-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-398"><a href="#cb94-398" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-399"><a href="#cb94-399" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-400"><a href="#cb94-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-401"><a href="#cb94-401" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-402"><a href="#cb94-402" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-403"><a href="#cb94-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-404"><a href="#cb94-404" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-405"><a href="#cb94-405" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-406"><a href="#cb94-406" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-407"><a href="#cb94-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-408"><a href="#cb94-408" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-409"><a href="#cb94-409" aria-hidden="true" tabindex="-1"></a>xy_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span>
<span id="cb94-410"><a href="#cb94-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-411"><a href="#cb94-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-412"><a href="#cb94-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-413"><a href="#cb94-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-414"><a href="#cb94-414" aria-hidden="true" tabindex="-1"></a>These two variables can be input in a regression model to evaluate the association between them:</span>
<span id="cb94-415"><a href="#cb94-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-418"><a href="#cb94-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-419"><a href="#cb94-419" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-420"><a href="#cb94-420" aria-hidden="true" tabindex="-1"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb94-421"><a href="#cb94-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-422"><a href="#cb94-422" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb94-423"><a href="#cb94-423" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb94-424"><a href="#cb94-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb94-425"><a href="#cb94-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="co"># plot points</span></span>
<span id="cb94-426"><a href="#cb94-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-427"><a href="#cb94-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-428"><a href="#cb94-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-429"><a href="#cb94-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-430"><a href="#cb94-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-431"><a href="#cb94-431" aria-hidden="true" tabindex="-1"></a>Which is equivalent to:</span>
<span id="cb94-432"><a href="#cb94-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-433"><a href="#cb94-433" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}$&lt;/font&gt;</span>
<span id="cb94-434"><a href="#cb94-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-435"><a href="#cb94-435" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-436"><a href="#cb94-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-437"><a href="#cb94-437" aria-hidden="true" tabindex="-1"></a>Let's print the summary for this model:</span>
<span id="cb94-438"><a href="#cb94-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-441"><a href="#cb94-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-442"><a href="#cb94-442" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod)</span>
<span id="cb94-443"><a href="#cb94-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-444"><a href="#cb94-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-445"><a href="#cb94-445" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-446"><a href="#cb94-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-447"><a href="#cb94-447" aria-hidden="true" tabindex="-1"></a>... and plot the effect sizes:</span>
<span id="cb94-450"><a href="#cb94-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-451"><a href="#cb94-451" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod<span class="sc">$</span>coefficients), </span>
<span id="cb94-452"><a href="#cb94-452" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> xy_mod<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod))</span>
<span id="cb94-453"><a href="#cb94-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-454"><a href="#cb94-454" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-455"><a href="#cb94-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-456"><a href="#cb94-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-457"><a href="#cb94-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-458"><a href="#cb94-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-459"><a href="#cb94-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-460"><a href="#cb94-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-461"><a href="#cb94-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-462"><a href="#cb94-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-463"><a href="#cb94-463" aria-hidden="true" tabindex="-1"></a>We should 'diagnose' the adequacy of the model by inspecting more closely the distribution of residuals.The function <span class="in">`plot_model()`</span> from the package 'sjPlot' does a good job for creating diagnostic plots for linear models:</span>
<span id="cb94-464"><a href="#cb94-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-465"><a href="#cb94-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "80%", fig.height=4}</span></span>
<span id="cb94-466"><a href="#cb94-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-467"><a href="#cb94-467" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model(xy_mod, type = "diag")</span></span>
<span id="cb94-468"><a href="#cb94-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-469"><a href="#cb94-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-470"><a href="#cb94-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-471"><a href="#cb94-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-472"><a href="#cb94-472" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-473"><a href="#cb94-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-474"><a href="#cb94-474" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-475"><a href="#cb94-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-476"><a href="#cb94-476" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-477"><a href="#cb94-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-478"><a href="#cb94-478" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-479"><a href="#cb94-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-480"><a href="#cb94-480" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-481"><a href="#cb94-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-482"><a href="#cb94-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-483"><a href="#cb94-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-484"><a href="#cb94-484" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod &lt;- summary(xy_mod)</span></span>
<span id="cb94-485"><a href="#cb94-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-486"><a href="#cb94-486" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod$coefficients</span></span>
<span id="cb94-487"><a href="#cb94-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-488"><a href="#cb94-488" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-489"><a href="#cb94-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-490"><a href="#cb94-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this example we added one predictor to the model so we got an additional estimate (and extra row, 'x1')</span>
<span id="cb94-491"><a href="#cb94-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-492"><a href="#cb94-492" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model tell us that the estimate of 'x1' is <span class="in">`r summ_xy_mod$coefficients[2, 1]`</span> and that it is not significantly different from 0 (p-value = <span class="in">`r summ_xy_mod$coefficients[2, 4]`</span>)</span>
<span id="cb94-493"><a href="#cb94-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-494"><a href="#cb94-494" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-495"><a href="#cb94-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-496"><a href="#cb94-496" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-497"><a href="#cb94-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-498"><a href="#cb94-498" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-499"><a href="#cb94-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-500"><a href="#cb94-500" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulating an associated predictor</span></span>
<span id="cb94-501"><a href="#cb94-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-502"><a href="#cb94-502" aria-hidden="true" tabindex="-1"></a>We can use the linear model formula above to simulate two associated continuous variables like this:</span>
<span id="cb94-503"><a href="#cb94-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-506"><a href="#cb94-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-507"><a href="#cb94-507" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-508"><a href="#cb94-508" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-509"><a href="#cb94-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-510"><a href="#cb94-510" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-511"><a href="#cb94-511" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-512"><a href="#cb94-512" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb94-513"><a href="#cb94-513" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb94-514"><a href="#cb94-514" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb94-515"><a href="#cb94-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-516"><a href="#cb94-516" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-517"><a href="#cb94-517" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-518"><a href="#cb94-518" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb94-519"><a href="#cb94-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-520"><a href="#cb94-520" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-521"><a href="#cb94-521" aria-hidden="true" tabindex="-1"></a>xy_data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span>
<span id="cb94-522"><a href="#cb94-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-523"><a href="#cb94-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-524"><a href="#cb94-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-525"><a href="#cb94-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-526"><a href="#cb94-526" aria-hidden="true" tabindex="-1"></a>Note that **we also added an error term**, so the association is not perfect. Let's run the model and plot the association between the two variables:</span>
<span id="cb94-527"><a href="#cb94-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-530"><a href="#cb94-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-531"><a href="#cb94-531" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-532"><a href="#cb94-532" aria-hidden="true" tabindex="-1"></a>xy_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data2)</span>
<span id="cb94-533"><a href="#cb94-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-534"><a href="#cb94-534" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb94-535"><a href="#cb94-535" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data2, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb94-536"><a href="#cb94-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb94-537"><a href="#cb94-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="co"># plot points</span></span>
<span id="cb94-538"><a href="#cb94-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-539"><a href="#cb94-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-540"><a href="#cb94-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-541"><a href="#cb94-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-542"><a href="#cb94-542" aria-hidden="true" tabindex="-1"></a>The formula is the same than the previous model:</span>
<span id="cb94-543"><a href="#cb94-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-544"><a href="#cb94-544" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}$&lt;/font&gt;</span>
<span id="cb94-545"><a href="#cb94-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-546"><a href="#cb94-546" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-547"><a href="#cb94-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-548"><a href="#cb94-548" aria-hidden="true" tabindex="-1"></a>This is the summary of the model:</span>
<span id="cb94-551"><a href="#cb94-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-552"><a href="#cb94-552" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod2)</span>
<span id="cb94-553"><a href="#cb94-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-554"><a href="#cb94-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-555"><a href="#cb94-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-556"><a href="#cb94-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-557"><a href="#cb94-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-558"><a href="#cb94-558" aria-hidden="true" tabindex="-1"></a>.. the effect size plot:</span>
<span id="cb94-561"><a href="#cb94-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-562"><a href="#cb94-562" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod2<span class="sc">$</span>coefficients), </span>
<span id="cb94-563"><a href="#cb94-563" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> xy_mod2<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod2))</span>
<span id="cb94-564"><a href="#cb94-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-565"><a href="#cb94-565" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-566"><a href="#cb94-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-567"><a href="#cb94-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-568"><a href="#cb94-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-569"><a href="#cb94-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-570"><a href="#cb94-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-571"><a href="#cb94-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-572"><a href="#cb94-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-573"><a href="#cb94-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-574"><a href="#cb94-574" aria-hidden="true" tabindex="-1"></a>... and the model diagnostic plots:</span>
<span id="cb94-575"><a href="#cb94-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "80%", fig.height=4}</span></span>
<span id="cb94-576"><a href="#cb94-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-577"><a href="#cb94-577" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model(xy_mod2, type = "diag")</span></span>
<span id="cb94-578"><a href="#cb94-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-579"><a href="#cb94-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-580"><a href="#cb94-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-581"><a href="#cb94-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-582"><a href="#cb94-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-583"><a href="#cb94-583" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-584"><a href="#cb94-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-585"><a href="#cb94-585" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-586"><a href="#cb94-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-587"><a href="#cb94-587" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-588"><a href="#cb94-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-589"><a href="#cb94-589" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-590"><a href="#cb94-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-591"><a href="#cb94-591" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-592"><a href="#cb94-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-593"><a href="#cb94-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-594"><a href="#cb94-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-595"><a href="#cb94-595" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod2 &lt;- summary(xy_mod2)</span></span>
<span id="cb94-596"><a href="#cb94-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-597"><a href="#cb94-597" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod2$coefficients</span></span>
<span id="cb94-598"><a href="#cb94-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-599"><a href="#cb94-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-600"><a href="#cb94-600" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model tells us that $\beta_1$ (the effect size of 'x1') is <span class="in">`r summ_xy_mod2$coefficients[2, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r summ_xy_mod2$coefficients[2, 4]`</span>)</span>
<span id="cb94-601"><a href="#cb94-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-602"><a href="#cb94-602" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The simulated values for the regression parameters can be compared to the summary of the <span class="in">`lm()`</span> model to get a sense of the model precision:</span>
<span id="cb94-603"><a href="#cb94-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-604"><a href="#cb94-604" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_1$ (the effect size of 'x1') was set to <span class="in">`r b1`</span> and was estimated as <span class="in">`r round(summ_xy_mod2$coefficients[2, 1], 3)`</span> by the model  </span>
<span id="cb94-605"><a href="#cb94-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-606"><a href="#cb94-606" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-607"><a href="#cb94-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-608"><a href="#cb94-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-609"><a href="#cb94-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-610"><a href="#cb94-610" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-611"><a href="#cb94-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-612"><a href="#cb94-612" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;font size="5"&gt;&lt;b&gt;Case study&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</span>
<span id="cb94-613"><a href="#cb94-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-614"><a href="#cb94-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-615"><a href="#cb94-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-616"><a href="#cb94-616" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Keenan EL, Odom  KJ, Araya-Salas M, Horton KG, Strimas-Mackey M, Meatte MA, Mann NI, Slater PJ, Price JJ, and Templeton  CN. 2020. <span class="co">[</span><span class="ot">**Breeding season length predicts duet coordination and consistency in Neotropical wrens (Troglodytidae)**</span><span class="co">](https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.2482)</span>. *Proceeding of the Royal Society B*. 20202482</span>
<span id="cb94-617"><a href="#cb94-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-618"><a href="#cb94-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-619"><a href="#cb94-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-620"><a href="#cb94-620" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/duets.png")</span></span>
<span id="cb94-621"><a href="#cb94-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-622"><a href="#cb94-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-623"><a href="#cb94-623" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-624"><a href="#cb94-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-625"><a href="#cb94-625" aria-hidden="true" tabindex="-1"></a>"*... coordination and consistency of duets are greater in species with particularly long mating seasons.*"</span>
<span id="cb94-626"><a href="#cb94-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-627"><a href="#cb94-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-628"><a href="#cb94-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "70%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-629"><a href="#cb94-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-630"><a href="#cb94-630" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/duet_reg.png")</span></span>
<span id="cb94-631"><a href="#cb94-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-632"><a href="#cb94-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-633"><a href="#cb94-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-634"><a href="#cb94-634" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-635"><a href="#cb94-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-636"><a href="#cb94-636" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-637"><a href="#cb94-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-638"><a href="#cb94-638" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-639"><a href="#cb94-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-640"><a href="#cb94-640" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-641"><a href="#cb94-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-642"><a href="#cb94-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-643"><a href="#cb94-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-644"><a href="#cb94-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increase the sample size (<span class="in">`n`</span>) to 1000 or higher</span>
<span id="cb94-645"><a href="#cb94-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-646"><a href="#cb94-646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How did the effect size ($\beta$) estimates change? </span>
<span id="cb94-647"><a href="#cb94-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-648"><a href="#cb94-648" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How did the standard error of the effect size change?</span>
<span id="cb94-649"><a href="#cb94-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-650"><a href="#cb94-650" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now change <span class="in">`n`</span> to 15 and check again the model estimates (this time check the p-value as well)</span>
<span id="cb94-651"><a href="#cb94-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-652"><a href="#cb94-652" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-653"><a href="#cb94-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-654"><a href="#cb94-654" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-655"><a href="#cb94-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-656"><a href="#cb94-656" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-657"><a href="#cb94-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-658"><a href="#cb94-658" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adding more than 1 predictor: multiple regression</span></span>
<span id="cb94-659"><a href="#cb94-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-660"><a href="#cb94-660" aria-hidden="true" tabindex="-1"></a>Multiple linear regression is an extension of the simple linear regression model that can take several predictors:</span>
<span id="cb94-661"><a href="#cb94-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-662"><a href="#cb94-662" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \cdots + \beta_{n} * x_{n}$&lt;/font&gt;</span>
<span id="cb94-663"><a href="#cb94-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-664"><a href="#cb94-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-665"><a href="#cb94-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-666"><a href="#cb94-666" aria-hidden="true" tabindex="-1"></a>The formula looks a bit busy, but it only means that any additional parameter will have its own estimate ($\beta$). The formula for a two-predictor linear regression looks like this:</span>
<span id="cb94-667"><a href="#cb94-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-668"><a href="#cb94-668" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \beta_{2} * x_{2}$&lt;/font&gt;</span>
<span id="cb94-669"><a href="#cb94-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-670"><a href="#cb94-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-671"><a href="#cb94-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-672"><a href="#cb94-672" aria-hidden="true" tabindex="-1"></a>.. and it can be simulated like this:</span>
<span id="cb94-675"><a href="#cb94-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-676"><a href="#cb94-676" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-677"><a href="#cb94-677" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-678"><a href="#cb94-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-679"><a href="#cb94-679" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-680"><a href="#cb94-680" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-681"><a href="#cb94-681" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb94-682"><a href="#cb94-682" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb94-683"><a href="#cb94-683" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb94-684"><a href="#cb94-684" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb94-685"><a href="#cb94-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-686"><a href="#cb94-686" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-687"><a href="#cb94-687" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-688"><a href="#cb94-688" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-689"><a href="#cb94-689" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb94-690"><a href="#cb94-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-691"><a href="#cb94-691" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-692"><a href="#cb94-692" aria-hidden="true" tabindex="-1"></a>xy_data_multp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb94-693"><a href="#cb94-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-694"><a href="#cb94-694" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-695"><a href="#cb94-695" aria-hidden="true" tabindex="-1"></a>xy_mod_multp <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_data_multp)</span>
<span id="cb94-696"><a href="#cb94-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-697"><a href="#cb94-697" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_multp)</span>
<span id="cb94-698"><a href="#cb94-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-699"><a href="#cb94-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-700"><a href="#cb94-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-701"><a href="#cb94-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-702"><a href="#cb94-702" aria-hidden="true" tabindex="-1"></a>... plot the effect sizes:</span>
<span id="cb94-705"><a href="#cb94-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-706"><a href="#cb94-706" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_multp<span class="sc">$</span>coefficients), </span>
<span id="cb94-707"><a href="#cb94-707" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> xy_mod_multp<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_multp))</span>
<span id="cb94-708"><a href="#cb94-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-709"><a href="#cb94-709" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-710"><a href="#cb94-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-711"><a href="#cb94-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-712"><a href="#cb94-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-713"><a href="#cb94-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-714"><a href="#cb94-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-715"><a href="#cb94-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-716"><a href="#cb94-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-717"><a href="#cb94-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-718"><a href="#cb94-718" aria-hidden="true" tabindex="-1"></a>... and the model diagnostic plots:</span>
<span id="cb94-719"><a href="#cb94-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "80%", fig.height=4}</span></span>
<span id="cb94-720"><a href="#cb94-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-721"><a href="#cb94-721" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model(xy_mod_multp, type = "diag")</span></span>
<span id="cb94-722"><a href="#cb94-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-723"><a href="#cb94-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-724"><a href="#cb94-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-725"><a href="#cb94-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-726"><a href="#cb94-726" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-727"><a href="#cb94-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-728"><a href="#cb94-728" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-729"><a href="#cb94-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-730"><a href="#cb94-730" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-731"><a href="#cb94-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-732"><a href="#cb94-732" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-733"><a href="#cb94-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-734"><a href="#cb94-734" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-735"><a href="#cb94-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-736"><a href="#cb94-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-737"><a href="#cb94-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-738"><a href="#cb94-738" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod_multp &lt;- summary(xy_mod_multp)</span></span>
<span id="cb94-739"><a href="#cb94-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-740"><a href="#cb94-740" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod_multp$coefficients</span></span>
<span id="cb94-741"><a href="#cb94-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-742"><a href="#cb94-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-743"><a href="#cb94-743" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model found that $\beta_1$ (the effect size of 'x1') is <span class="in">`r summ_xy_mod_multp$coefficients[2, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r summ_xy_mod_multp$coefficients[2, 4]`</span>)</span>
<span id="cb94-744"><a href="#cb94-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-745"><a href="#cb94-745" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It also found that the $\beta_2$ (the effect size of 'x2') is <span class="in">`r summ_xy_mod_multp$coefficients[3, 1]`</span> and that it is also significantly different from 0 (p-value = <span class="in">`r summ_xy_mod_multp$coefficients[3, 4]`</span>)</span>
<span id="cb94-746"><a href="#cb94-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-747"><a href="#cb94-747" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The simulated values for the regression parameters can be compared to the summary of the <span class="in">`lm()`</span> model to get a sense of the model precision:</span>
<span id="cb94-748"><a href="#cb94-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-749"><a href="#cb94-749" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_1$ was set to <span class="in">`r b1`</span> and was estimated as <span class="in">`r round(summ_xy_mod_multp$coefficients[2, 1], 3)`</span></span>
<span id="cb94-750"><a href="#cb94-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-751"><a href="#cb94-751" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_2$ (the effect size of 'x2') was set to <span class="in">`r b2`</span> and was estimated as <span class="in">`r round(summ_xy_mod_multp$coefficients[3, 1], 3)`</span></span>
<span id="cb94-752"><a href="#cb94-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-753"><a href="#cb94-753" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-754"><a href="#cb94-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-755"><a href="#cb94-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-756"><a href="#cb94-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-757"><a href="#cb94-757" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-758"><a href="#cb94-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-759"><a href="#cb94-759" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;font size="5"&gt;&lt;b&gt;Case study&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</span>
<span id="cb94-760"><a href="#cb94-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-761"><a href="#cb94-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-762"><a href="#cb94-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-763"><a href="#cb94-763" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Araya-Salas M, P González-Gómez, K Wojczulanis-Jakubas, V López III &amp; T Wright. 2018. <span class="co">[</span><span class="ot">**Spatial memory is as important as weapon and body size for territorial ownership in a lekking hummingbird**</span><span class="co">](https://www.nature.com/articles/s41598-018-20441-x)</span>. *Scientific Reports*. 13, e0189969</span>
<span id="cb94-764"><a href="#cb94-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-765"><a href="#cb94-765" aria-hidden="true" tabindex="-1"></a>"*Spatial memory, body size and beak tip length ... positively predicted the probability of acquiring and defending a territory.*"</span>
<span id="cb94-766"><a href="#cb94-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-767"><a href="#cb94-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "100%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-768"><a href="#cb94-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-769"><a href="#cb94-769" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/lbh_cognition.png")</span></span>
<span id="cb94-770"><a href="#cb94-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-771"><a href="#cb94-771" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-772"><a href="#cb94-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-773"><a href="#cb94-773" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-774"><a href="#cb94-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-775"><a href="#cb94-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-776"><a href="#cb94-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-777"><a href="#cb94-777" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-778"><a href="#cb94-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-779"><a href="#cb94-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-780"><a href="#cb94-780" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-781"><a href="#cb94-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-782"><a href="#cb94-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-783"><a href="#cb94-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-784"><a href="#cb94-784" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set one of the effect sizes ($\beta$) to 0 (or very close to 0) and run again the model and its summary</span>
<span id="cb94-785"><a href="#cb94-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-786"><a href="#cb94-786" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How did the p-value change?</span>
<span id="cb94-787"><a href="#cb94-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-788"><a href="#cb94-788" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simulate a scenario with two predictors in which only one of them is associated with the response</span>
<span id="cb94-789"><a href="#cb94-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-790"><a href="#cb94-790" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-791"><a href="#cb94-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-792"><a href="#cb94-792" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-793"><a href="#cb94-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-794"><a href="#cb94-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-795"><a href="#cb94-795" aria-hidden="true" tabindex="-1"></a>There is an important point to stress here: **Multiple regression estimate the effect of a predictor after accounting for the effect of the other predictors in the model**. In other words, new predictors in the model will attempt to explain variation in the data that was not explained by the other predictors. So **the result of the multiple regression is not equivalent to the results of simple linear regressions** on the same predictors. This can be easily shown by running those regressions:</span>
<span id="cb94-796"><a href="#cb94-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-799"><a href="#cb94-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-800"><a href="#cb94-800" aria-hidden="true" tabindex="-1"></a><span class="co"># build models</span></span>
<span id="cb94-801"><a href="#cb94-801" aria-hidden="true" tabindex="-1"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb94-802"><a href="#cb94-802" aria-hidden="true" tabindex="-1"></a>x2y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2, <span class="at">data =</span> xy_data)</span>
<span id="cb94-803"><a href="#cb94-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-804"><a href="#cb94-804" aria-hidden="true" tabindex="-1"></a><span class="co"># shortcut to coefficients</span></span>
<span id="cb94-805"><a href="#cb94-805" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(xy_mod)</span>
<span id="cb94-806"><a href="#cb94-806" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x1y_mod)</span>
<span id="cb94-807"><a href="#cb94-807" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x2y_mod)</span>
<span id="cb94-808"><a href="#cb94-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-809"><a href="#cb94-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-810"><a href="#cb94-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-811"><a href="#cb94-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-812"><a href="#cb94-812" aria-hidden="true" tabindex="-1"></a>The estimates for the same variables vary considerably between the multiple regression and the single predictor regressions.</span>
<span id="cb94-813"><a href="#cb94-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-814"><a href="#cb94-814" aria-hidden="true" tabindex="-1"></a>This point is further demonstrated by the fact that, if one of the predictors has no influence at all on the response, the effect of the additional predictor will converge to its effect in a simple linear regression. To simulate this scenario we set b2 to 0:</span>
<span id="cb94-815"><a href="#cb94-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-818"><a href="#cb94-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-819"><a href="#cb94-819" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-820"><a href="#cb94-820" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-821"><a href="#cb94-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-822"><a href="#cb94-822" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-823"><a href="#cb94-823" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-824"><a href="#cb94-824" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb94-825"><a href="#cb94-825" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb94-826"><a href="#cb94-826" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb94-827"><a href="#cb94-827" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-828"><a href="#cb94-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-829"><a href="#cb94-829" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-830"><a href="#cb94-830" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-831"><a href="#cb94-831" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-832"><a href="#cb94-832" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb94-833"><a href="#cb94-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-834"><a href="#cb94-834" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-835"><a href="#cb94-835" aria-hidden="true" tabindex="-1"></a>xy_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb94-836"><a href="#cb94-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-837"><a href="#cb94-837" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-838"><a href="#cb94-838" aria-hidden="true" tabindex="-1"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_data)</span>
<span id="cb94-839"><a href="#cb94-839" aria-hidden="true" tabindex="-1"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data)</span>
<span id="cb94-840"><a href="#cb94-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-841"><a href="#cb94-841" aria-hidden="true" tabindex="-1"></a><span class="co"># shortcut to coefficients</span></span>
<span id="cb94-842"><a href="#cb94-842" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(xy_mod)</span>
<span id="cb94-843"><a href="#cb94-843" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(x1y_mod)</span>
<span id="cb94-844"><a href="#cb94-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-845"><a href="#cb94-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-846"><a href="#cb94-846" aria-hidden="true" tabindex="-1"></a>The estimate for $\beta_1$ was almost the same in the multiple regression (<span class="in">`r coef(xy_mod)[2]`</span>) and the single predictor regression (<span class="in">`r coef(x1y_mod)[2]`</span>)</span>
<span id="cb94-847"><a href="#cb94-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-848"><a href="#cb94-848" aria-hidden="true" tabindex="-1"></a>For convenience we used <span class="in">`coef()`</span> to extract only the estimates from the regression, but the values are the same we get with <span class="in">`summary(model)`</span>.</span>
<span id="cb94-849"><a href="#cb94-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-850"><a href="#cb94-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-851"><a href="#cb94-851" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-852"><a href="#cb94-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-853"><a href="#cb94-853" aria-hidden="true" tabindex="-1"></a><span class="fu">## Having a categorical predictor</span></span>
<span id="cb94-854"><a href="#cb94-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-855"><a href="#cb94-855" aria-hidden="true" tabindex="-1"></a>For categorical predictors we can first create a binary (0, 1) variable and then add labels to each value:</span>
<span id="cb94-856"><a href="#cb94-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-859"><a href="#cb94-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-860"><a href="#cb94-860" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-861"><a href="#cb94-861" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb94-862"><a href="#cb94-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-863"><a href="#cb94-863" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-864"><a href="#cb94-864" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-865"><a href="#cb94-865" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb94-866"><a href="#cb94-866" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb94-867"><a href="#cb94-867" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb94-868"><a href="#cb94-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-869"><a href="#cb94-869" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-870"><a href="#cb94-870" aria-hidden="true" tabindex="-1"></a>x1_num <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-871"><a href="#cb94-871" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1_num <span class="sc">+</span> error</span>
<span id="cb94-872"><a href="#cb94-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-873"><a href="#cb94-873" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1_num, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb94-874"><a href="#cb94-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-875"><a href="#cb94-875" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-876"><a href="#cb94-876" aria-hidden="true" tabindex="-1"></a>xy_data_cat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x1_num, y)</span>
<span id="cb94-877"><a href="#cb94-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-878"><a href="#cb94-878" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_cat)</span>
<span id="cb94-879"><a href="#cb94-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-880"><a href="#cb94-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-881"><a href="#cb94-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-882"><a href="#cb94-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-883"><a href="#cb94-883" aria-hidden="true" tabindex="-1"></a>And this is how it is formally written:</span>
<span id="cb94-884"><a href="#cb94-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-885"><a href="#cb94-885" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1}$&lt;/font&gt;</span>
<span id="cb94-886"><a href="#cb94-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-887"><a href="#cb94-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-888"><a href="#cb94-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-889"><a href="#cb94-889" aria-hidden="true" tabindex="-1"></a>Same thing as with continuous predictors. </span>
<span id="cb94-890"><a href="#cb94-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-891"><a href="#cb94-891" aria-hidden="true" tabindex="-1"></a>We can explore the pattern in the data using a boxplot:</span>
<span id="cb94-892"><a href="#cb94-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-895"><a href="#cb94-895" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-896"><a href="#cb94-896" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb94-897"><a href="#cb94-897" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data_cat, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb94-898"><a href="#cb94-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb94-899"><a href="#cb94-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-900"><a href="#cb94-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-901"><a href="#cb94-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-902"><a href="#cb94-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-903"><a href="#cb94-903" aria-hidden="true" tabindex="-1"></a>... and get the estimates of the model:</span>
<span id="cb94-906"><a href="#cb94-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-907"><a href="#cb94-907" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-908"><a href="#cb94-908" aria-hidden="true" tabindex="-1"></a>xy_mod_cat <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data_cat)</span>
<span id="cb94-909"><a href="#cb94-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-910"><a href="#cb94-910" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_cat)</span>
<span id="cb94-911"><a href="#cb94-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-912"><a href="#cb94-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-913"><a href="#cb94-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-914"><a href="#cb94-914" aria-hidden="true" tabindex="-1"></a>... plot the effect sizes:</span>
<span id="cb94-917"><a href="#cb94-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-918"><a href="#cb94-918" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_cat<span class="sc">$</span>coefficients), </span>
<span id="cb94-919"><a href="#cb94-919" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> xy_mod_cat<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_cat))</span>
<span id="cb94-920"><a href="#cb94-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-921"><a href="#cb94-921" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-922"><a href="#cb94-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-923"><a href="#cb94-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-924"><a href="#cb94-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-925"><a href="#cb94-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-926"><a href="#cb94-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-927"><a href="#cb94-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-928"><a href="#cb94-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-929"><a href="#cb94-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-930"><a href="#cb94-930" aria-hidden="true" tabindex="-1"></a>... and the model diagnostic plots:</span>
<span id="cb94-931"><a href="#cb94-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "80%", fig.height=4}</span></span>
<span id="cb94-932"><a href="#cb94-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-933"><a href="#cb94-933" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model(xy_mod_cat, type = "diag")[[2]]</span></span>
<span id="cb94-934"><a href="#cb94-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-935"><a href="#cb94-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-936"><a href="#cb94-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-937"><a href="#cb94-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-938"><a href="#cb94-938" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-939"><a href="#cb94-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-940"><a href="#cb94-940" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-941"><a href="#cb94-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-942"><a href="#cb94-942" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-943"><a href="#cb94-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-944"><a href="#cb94-944" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-945"><a href="#cb94-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-946"><a href="#cb94-946" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-947"><a href="#cb94-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-948"><a href="#cb94-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-949"><a href="#cb94-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-950"><a href="#cb94-950" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod_cat &lt;- summary(xy_mod_cat)</span></span>
<span id="cb94-951"><a href="#cb94-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-952"><a href="#cb94-952" aria-hidden="true" tabindex="-1"></a><span class="in">summ_xy_mod_cat$coefficients</span></span>
<span id="cb94-953"><a href="#cb94-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-954"><a href="#cb94-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-955"><a href="#cb94-955" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model found that $\beta_1$ (the effect size of 'x1') is <span class="in">`r summ_xy_mod_cat$coefficients[2, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r summ_xy_mod_cat$coefficients[2, 4]`</span>)</span>
<span id="cb94-956"><a href="#cb94-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-957"><a href="#cb94-957" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The simulated values for the regression parameters can be compared to the summary of the <span class="in">`lm()`</span> model to get a sense of the model precision:</span>
<span id="cb94-958"><a href="#cb94-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-959"><a href="#cb94-959" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_1$ was set to <span class="in">`r b1`</span> and was estimated as <span class="in">`r round(summ_xy_mod_cat$coefficients[2, 1], 3)`</span></span>
<span id="cb94-960"><a href="#cb94-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-961"><a href="#cb94-961" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that in this case the intercept refers to the estimate for the level 'a' in the categorical predictor, which was used as a baseline:</span>
<span id="cb94-962"><a href="#cb94-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-963"><a href="#cb94-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb94-964"><a href="#cb94-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-965"><a href="#cb94-965" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb94-966"><a href="#cb94-966" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(xy_data_cat, aes(x = x1, y = y)) + </span></span>
<span id="cb94-967"><a href="#cb94-967" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb94-968"><a href="#cb94-968" aria-hidden="true" tabindex="-1"></a><span class="in">geom_hline(yintercept = xy_mod_cat$coefficients[1], col = "blue")</span></span>
<span id="cb94-969"><a href="#cb94-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-970"><a href="#cb94-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-971"><a href="#cb94-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-972"><a href="#cb94-972" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb94-973"><a href="#cb94-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-974"><a href="#cb94-974" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(xy_data_cat, aes(x = x1, y = y)) + </span></span>
<span id="cb94-975"><a href="#cb94-975" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() + </span></span>
<span id="cb94-976"><a href="#cb94-976" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = xy_mod_cat$coefficients[1], col = "blue") +</span></span>
<span id="cb94-977"><a href="#cb94-977" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(panel.background = element_rect(fill = "#dff0d8"), plot.background = element_rect(fill = "#dff0d8", colour=NA))</span></span>
<span id="cb94-978"><a href="#cb94-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-979"><a href="#cb94-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-980"><a href="#cb94-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-981"><a href="#cb94-981" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hence the intercept is the same as the mean of y for the category 'a':</span>
<span id="cb94-984"><a href="#cb94-984" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-985"><a href="#cb94-985" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(xy_data_cat<span class="sc">$</span>y[xy_data_cat<span class="sc">$</span>x1 <span class="sc">==</span> <span class="st">"a"</span>])</span>
<span id="cb94-986"><a href="#cb94-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-987"><a href="#cb94-987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-988"><a href="#cb94-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-989"><a href="#cb94-989" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note also that the estimate label is 'x1b', not 'x1' as in the continuous predictors. This is because in this case the estimate refers to the difference between the two levels of the categorical variable ('a' and 'b'). More specifically, it tells us that in average observations from category 'b' are <span class="in">`r round(summ_xy_mod_cat$coefficients[2, 1], 3)`</span> higher than observations in category 'a'.</span>
<span id="cb94-990"><a href="#cb94-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-991"><a href="#cb94-991" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-992"><a href="#cb94-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-993"><a href="#cb94-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-994"><a href="#cb94-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-995"><a href="#cb94-995" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-996"><a href="#cb94-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-997"><a href="#cb94-997" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;font size="5"&gt;&lt;b&gt;Caso de estudio&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</span>
<span id="cb94-998"><a href="#cb94-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-999"><a href="#cb94-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1000"><a href="#cb94-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1001"><a href="#cb94-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rico-Guevara A, &amp; M Araya-Salas. 2015. <span class="co">[</span><span class="ot">**Bills as daggers? A test for sexually dimorphic weapons in a lekking hummingbird species**</span><span class="co">](https://academic.oup.com/beheco/article/26/1/21/2262689)</span>. *Behavioral Ecology*. 26 (1): 21-29. </span>
<span id="cb94-1002"><a href="#cb94-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1003"><a href="#cb94-1003" aria-hidden="true" tabindex="-1"></a>"*Males with larger, more pointed beak tips were more successful in gaining control of territories in the lek.*"</span>
<span id="cb94-1004"><a href="#cb94-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1005"><a href="#cb94-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1006"><a href="#cb94-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "75%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-1007"><a href="#cb94-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1008"><a href="#cb94-1008" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/daggers_lbh.png")</span></span>
<span id="cb94-1009"><a href="#cb94-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1010"><a href="#cb94-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1011"><a href="#cb94-1011" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1012"><a href="#cb94-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1013"><a href="#cb94-1013" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1014"><a href="#cb94-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1015"><a href="#cb94-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1016"><a href="#cb94-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1017"><a href="#cb94-1017" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-1018"><a href="#cb94-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1019"><a href="#cb94-1019" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-1020"><a href="#cb94-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1021"><a href="#cb94-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1022"><a href="#cb94-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1023"><a href="#cb94-1023" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unbalanced data when having categories (i.e. some categories have way more observations than others) can be problematic for statistical inference. Modify the code <span class="co">[</span><span class="ot">above</span><span class="co">](#cb99-1)</span> to simulate a highly unbalanced data set and check the precision of the model.</span>
<span id="cb94-1024"><a href="#cb94-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1025"><a href="#cb94-1025" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1026"><a href="#cb94-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1027"><a href="#cb94-1027" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1028"><a href="#cb94-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1029"><a href="#cb94-1029" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-1030"><a href="#cb94-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1031"><a href="#cb94-1031" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;Dummy coding&lt;/font&gt;</span>
<span id="cb94-1032"><a href="#cb94-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1033"><a href="#cb94-1033" aria-hidden="true" tabindex="-1"></a>In a regression model categorical predictors are also represented as numeric vectors. More precisely, categorical predictors are coded as 0s and 1s, in which 1 means 'belongs to the same category' and 0 'belongs to a different category'. We kept the original numeric vector ('x1_num') when simulating the data set with the categorical predictor:</span>
<span id="cb94-1034"><a href="#cb94-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1037"><a href="#cb94-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1038"><a href="#cb94-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_cat)</span>
<span id="cb94-1039"><a href="#cb94-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1040"><a href="#cb94-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1041"><a href="#cb94-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1042"><a href="#cb94-1042" aria-hidden="true" tabindex="-1"></a>Note that 'b's in the 'x1' column are converted into 1 in the 'x1_num' column and 'a's converted into 0. This is called an indicator variable and the process is known as dummy coding. </span>
<span id="cb94-1043"><a href="#cb94-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1044"><a href="#cb94-1044" aria-hidden="true" tabindex="-1"></a>We can actually use the numeric vector in the regression model and get the exact same results:</span>
<span id="cb94-1045"><a href="#cb94-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1048"><a href="#cb94-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1049"><a href="#cb94-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># summary model with categorical variable</span></span>
<span id="cb94-1050"><a href="#cb94-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_cat)<span class="sc">$</span>coefficients</span>
<span id="cb94-1051"><a href="#cb94-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1052"><a href="#cb94-1052" aria-hidden="true" tabindex="-1"></a><span class="co"># build model with dummy variable</span></span>
<span id="cb94-1053"><a href="#cb94-1053" aria-hidden="true" tabindex="-1"></a>xy_mod_num <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1_num, <span class="at">data =</span> xy_data_cat)</span>
<span id="cb94-1054"><a href="#cb94-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1055"><a href="#cb94-1055" aria-hidden="true" tabindex="-1"></a><span class="co"># summary with dummy coding</span></span>
<span id="cb94-1056"><a href="#cb94-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xy_mod_num)<span class="sc">$</span>coefficients</span>
<span id="cb94-1057"><a href="#cb94-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1058"><a href="#cb94-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1059"><a href="#cb94-1059" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1060"><a href="#cb94-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1061"><a href="#cb94-1061" aria-hidden="true" tabindex="-1"></a>Things get a bit more complicated when dummy coding a categorical predictor with more than two levels. But the logic is the same.</span>
<span id="cb94-1062"><a href="#cb94-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1063"><a href="#cb94-1063" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1064"><a href="#cb94-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1065"><a href="#cb94-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1066"><a href="#cb94-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1067"><a href="#cb94-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1068"><a href="#cb94-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = FALSE}</span></span>
<span id="cb94-1069"><a href="#cb94-1069" aria-hidden="true" tabindex="-1"></a><span class="in">This approach can be extended to simulate categorical variables with more than 2 levels:</span></span>
<span id="cb94-1070"><a href="#cb94-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1071"><a href="#cb94-1071" aria-hidden="true" tabindex="-1"></a><span class="in"># set seed</span></span>
<span id="cb94-1072"><a href="#cb94-1072" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb94-1073"><a href="#cb94-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1074"><a href="#cb94-1074" aria-hidden="true" tabindex="-1"></a><span class="in"># number of observations</span></span>
<span id="cb94-1075"><a href="#cb94-1075" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 50</span></span>
<span id="cb94-1076"><a href="#cb94-1076" aria-hidden="true" tabindex="-1"></a><span class="in">b0 &lt;- -4</span></span>
<span id="cb94-1077"><a href="#cb94-1077" aria-hidden="true" tabindex="-1"></a><span class="in">b1 &lt;- 3</span></span>
<span id="cb94-1078"><a href="#cb94-1078" aria-hidden="true" tabindex="-1"></a><span class="in">error &lt;- rnorm(n = n, mean = 0, sd = 1)</span></span>
<span id="cb94-1079"><a href="#cb94-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1080"><a href="#cb94-1080" aria-hidden="true" tabindex="-1"></a><span class="in"># random variables</span></span>
<span id="cb94-1081"><a href="#cb94-1081" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- rbinom(n = n, size = 2, prob = c(0.33, 0.33))</span></span>
<span id="cb94-1082"><a href="#cb94-1082" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- b0 + b1 * x1 + error</span></span>
<span id="cb94-1083"><a href="#cb94-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1084"><a href="#cb94-1084" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;- factor(x1, labels = c("a", "b", "c"))</span></span>
<span id="cb94-1085"><a href="#cb94-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1086"><a href="#cb94-1086" aria-hidden="true" tabindex="-1"></a><span class="in"># create data frame</span></span>
<span id="cb94-1087"><a href="#cb94-1087" aria-hidden="true" tabindex="-1"></a><span class="in">xy_data &lt;- data.frame(x1, y)</span></span>
<span id="cb94-1088"><a href="#cb94-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1089"><a href="#cb94-1089" aria-hidden="true" tabindex="-1"></a><span class="in"># boxplot(formula = y ~ x1, data = xy_data)</span></span>
<span id="cb94-1090"><a href="#cb94-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1091"><a href="#cb94-1091" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(xy_data, aes(x = x1, y = y)) + </span></span>
<span id="cb94-1092"><a href="#cb94-1092" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb94-1093"><a href="#cb94-1093" aria-hidden="true" tabindex="-1"></a><span class="in">geom_hline(yintercept = xy_mod$coefficients[1], col = "blue")</span></span>
<span id="cb94-1094"><a href="#cb94-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1095"><a href="#cb94-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1096"><a href="#cb94-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1097"><a href="#cb94-1097" aria-hidden="true" tabindex="-1"></a><span class="in">And these are the results:</span></span>
<span id="cb94-1098"><a href="#cb94-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1099"><a href="#cb94-1099" aria-hidden="true" tabindex="-1"></a><span class="in"># build model</span></span>
<span id="cb94-1100"><a href="#cb94-1100" aria-hidden="true" tabindex="-1"></a><span class="in">xy_mod &lt;- lm(formula = y ~ x1, data = xy_data)</span></span>
<span id="cb94-1101"><a href="#cb94-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1102"><a href="#cb94-1102" aria-hidden="true" tabindex="-1"></a><span class="in">summary(xy_mod)</span></span>
<span id="cb94-1103"><a href="#cb94-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1104"><a href="#cb94-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1105"><a href="#cb94-1105" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1106"><a href="#cb94-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1107"><a href="#cb94-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction terms</span></span>
<span id="cb94-1108"><a href="#cb94-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1109"><a href="#cb94-1109" aria-hidden="true" tabindex="-1"></a>A statistical interaction refers to an effect of a response variable that is mediated by a second variable. </span>
<span id="cb94-1110"><a href="#cb94-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1111"><a href="#cb94-1111" aria-hidden="true" tabindex="-1"></a>&lt;font size = 6&gt;$\hat{Y} \sim \beta_{o} + \beta_{1} * x_{1} + \beta_{2} * x_{2} + \beta_{3} * x_{1} * x_{2}$&lt;/font&gt;</span>
<span id="cb94-1112"><a href="#cb94-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1113"><a href="#cb94-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1114"><a href="#cb94-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1115"><a href="#cb94-1115" aria-hidden="true" tabindex="-1"></a>This is easier to understand by looking at the interaction of a continuous and a binary variable:</span>
<span id="cb94-1116"><a href="#cb94-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1119"><a href="#cb94-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1120"><a href="#cb94-1120" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-1121"><a href="#cb94-1121" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-1122"><a href="#cb94-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1123"><a href="#cb94-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-1124"><a href="#cb94-1124" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-1125"><a href="#cb94-1125" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb94-1126"><a href="#cb94-1126" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb94-1127"><a href="#cb94-1127" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fl">1.7</span></span>
<span id="cb94-1128"><a href="#cb94-1128" aria-hidden="true" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb94-1129"><a href="#cb94-1129" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb94-1130"><a href="#cb94-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1131"><a href="#cb94-1131" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-1132"><a href="#cb94-1132" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb94-1133"><a href="#cb94-1133" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-1134"><a href="#cb94-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1135"><a href="#cb94-1135" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction is added as the product of x1 and x2</span></span>
<span id="cb94-1136"><a href="#cb94-1136" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> b3 <span class="sc">*</span> x1 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb94-1137"><a href="#cb94-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1138"><a href="#cb94-1138" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb94-1139"><a href="#cb94-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1140"><a href="#cb94-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-1141"><a href="#cb94-1141" aria-hidden="true" tabindex="-1"></a>xy_data_intr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb94-1142"><a href="#cb94-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1143"><a href="#cb94-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_intr)</span>
<span id="cb94-1144"><a href="#cb94-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1145"><a href="#cb94-1145" aria-hidden="true" tabindex="-1"></a><span class="co"># build model</span></span>
<span id="cb94-1146"><a href="#cb94-1146" aria-hidden="true" tabindex="-1"></a>xy_mod_intr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1 <span class="sc">*</span> x2, <span class="at">data =</span> xy_data_intr)</span>
<span id="cb94-1147"><a href="#cb94-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1148"><a href="#cb94-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary to make best fit lines</span></span>
<span id="cb94-1149"><a href="#cb94-1149" aria-hidden="true" tabindex="-1"></a>xy_summ_intr <span class="ot">&lt;-</span> <span class="fu">summary</span>(xy_mod_intr)</span>
<span id="cb94-1150"><a href="#cb94-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1151"><a href="#cb94-1151" aria-hidden="true" tabindex="-1"></a>xy_summ_intr</span>
<span id="cb94-1152"><a href="#cb94-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1153"><a href="#cb94-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1154"><a href="#cb94-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1155"><a href="#cb94-1155" aria-hidden="true" tabindex="-1"></a>It also helps to plot the data (don't worry too much about all the code):</span>
<span id="cb94-1156"><a href="#cb94-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1157"><a href="#cb94-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb94-1158"><a href="#cb94-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1159"><a href="#cb94-1159" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb94-1160"><a href="#cb94-1160" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = xy_data_intr, aes(x = x2, y = y, color = x1)) +</span></span>
<span id="cb94-1161"><a href="#cb94-1161" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(size = 3) +</span></span>
<span id="cb94-1162"><a href="#cb94-1162" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_smooth(method = "lm", se = FALSE)</span></span>
<span id="cb94-1163"><a href="#cb94-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1164"><a href="#cb94-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1165"><a href="#cb94-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1166"><a href="#cb94-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE, out.width = "80%"}</span></span>
<span id="cb94-1167"><a href="#cb94-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1168"><a href="#cb94-1168" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb94-1169"><a href="#cb94-1169" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = xy_data_intr, aes(x = x2, y = y, color = x1)) +</span></span>
<span id="cb94-1170"><a href="#cb94-1170" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(size = 3) + scale_color_viridis_d(end = 0.9, begin = 0.2, alpha = 0.6) +</span></span>
<span id="cb94-1171"><a href="#cb94-1171" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot2::geom_smooth(method = "lm", se = FALSE)</span></span>
<span id="cb94-1172"><a href="#cb94-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1173"><a href="#cb94-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1174"><a href="#cb94-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1175"><a href="#cb94-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1176"><a href="#cb94-1176" aria-hidden="true" tabindex="-1"></a>... and the effect sizes:</span>
<span id="cb94-1179"><a href="#cb94-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1180"><a href="#cb94-1180" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_intr<span class="sc">$</span>coefficients), </span>
<span id="cb94-1181"><a href="#cb94-1181" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> xy_mod_intr<span class="sc">$</span>coefficients, <span class="fu">confint</span>(xy_mod_intr))</span>
<span id="cb94-1182"><a href="#cb94-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1183"><a href="#cb94-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x=</span>param, <span class="at">y=</span>est)) <span class="sc">+</span> </span>
<span id="cb94-1184"><a href="#cb94-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb94-1185"><a href="#cb94-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span> </span>
<span id="cb94-1186"><a href="#cb94-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Parameter"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>) <span class="sc">+</span> </span>
<span id="cb94-1187"><a href="#cb94-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb94-1188"><a href="#cb94-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1189"><a href="#cb94-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1190"><a href="#cb94-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1191"><a href="#cb94-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1192"><a href="#cb94-1192" aria-hidden="true" tabindex="-1"></a>We should also check the diagnostic plots:</span>
<span id="cb94-1193"><a href="#cb94-1193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "80%", fig.height=4}</span></span>
<span id="cb94-1194"><a href="#cb94-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1195"><a href="#cb94-1195" aria-hidden="true" tabindex="-1"></a><span class="in">plot_model(xy_mod_intr, type = "diag")</span></span>
<span id="cb94-1196"><a href="#cb94-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1197"><a href="#cb94-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1198"><a href="#cb94-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1199"><a href="#cb94-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1200"><a href="#cb94-1200" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-1201"><a href="#cb94-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1202"><a href="#cb94-1202" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1203"><a href="#cb94-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1204"><a href="#cb94-1204" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-1205"><a href="#cb94-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1206"><a href="#cb94-1206" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1207"><a href="#cb94-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1208"><a href="#cb94-1208" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-1209"><a href="#cb94-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1210"><a href="#cb94-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-1211"><a href="#cb94-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1212"><a href="#cb94-1212" aria-hidden="true" tabindex="-1"></a><span class="in">xy_summ_intr$coefficients</span></span>
<span id="cb94-1213"><a href="#cb94-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1214"><a href="#cb94-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1215"><a href="#cb94-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1216"><a href="#cb94-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model found that $\beta_1$ (the effect size of 'x1-b' to 'x1-a') is <span class="in">`r xy_summ_intr$coefficients[2, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r xy_summ_intr$coefficients[2, 4]`</span>) </span>
<span id="cb94-1217"><a href="#cb94-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1218"><a href="#cb94-1218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model found that $\beta_2$ (the effect size of 'x2') is <span class="in">`r xy_summ_intr$coefficients[3, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r xy_summ_intr$coefficients[3, 4]`</span>). This is actually the slope of the relation between x2 and y when x1 = 'a' </span>
<span id="cb94-1219"><a href="#cb94-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1220"><a href="#cb94-1220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model found that $\beta_3$ (the effect size of the interaction term 'x1 * x2') is <span class="in">`r xy_summ_intr$coefficients[4, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r xy_summ_intr$coefficients[4, 4]`</span>). This is the difference between the slopes of x2 *vs* y when x1 = 'a' and x2 *vs* y when x1 = 'b'.  </span>
<span id="cb94-1221"><a href="#cb94-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1222"><a href="#cb94-1222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The simulated values for the regression parameters can be compared to the summary of the <span class="in">`lm()`</span> model to get a sense of the model precision:</span>
<span id="cb94-1223"><a href="#cb94-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1224"><a href="#cb94-1224" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_1$ was set to <span class="in">`r b1`</span> and was estimated as <span class="in">`r round(xy_summ_intr$coefficients[2, 1], 3)`</span></span>
<span id="cb94-1225"><a href="#cb94-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1226"><a href="#cb94-1226" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_2$ was set to <span class="in">`r b2`</span> and was estimated as <span class="in">`r round(xy_summ_intr$coefficients[3, 1], 3)`</span></span>
<span id="cb94-1227"><a href="#cb94-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1228"><a href="#cb94-1228" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\beta_3$ was set to <span class="in">`r b3`</span> and was estimated as <span class="in">`r round(xy_summ_intr$coefficients[4, 1], 3)`</span></span>
<span id="cb94-1229"><a href="#cb94-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1230"><a href="#cb94-1230" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1231"><a href="#cb94-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1232"><a href="#cb94-1232" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1233"><a href="#cb94-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1234"><a href="#cb94-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1235"><a href="#cb94-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1236"><a href="#cb94-1236" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb94-1237"><a href="#cb94-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1238"><a href="#cb94-1238" aria-hidden="true" tabindex="-1"></a>&lt;center&gt;&lt;font size="5"&gt;&lt;b&gt;Caso de estudio&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</span>
<span id="cb94-1239"><a href="#cb94-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1240"><a href="#cb94-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1241"><a href="#cb94-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1242"><a href="#cb94-1242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chirino F, B Wilink, Araya-Salas M. In prep. **Climatic factors affecting vocal activity in lemur leaf frogs**. </span>
<span id="cb94-1243"><a href="#cb94-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1244"><a href="#cb94-1244" aria-hidden="true" tabindex="-1"></a>"*Increased moonlight decreases the vocal activity of *Agalychnis lemur* although this relationship is mediated by temperature*."</span>
<span id="cb94-1245"><a href="#cb94-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1246"><a href="#cb94-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1247"><a href="#cb94-1247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "70%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-1248"><a href="#cb94-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1249"><a href="#cb94-1249" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/lemur.png")</span></span>
<span id="cb94-1250"><a href="#cb94-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1251"><a href="#cb94-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1252"><a href="#cb94-1252" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1253"><a href="#cb94-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1254"><a href="#cb94-1254" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1255"><a href="#cb94-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1256"><a href="#cb94-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1257"><a href="#cb94-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1258"><a href="#cb94-1258" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-1259"><a href="#cb94-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1260"><a href="#cb94-1260" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-1261"><a href="#cb94-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1262"><a href="#cb94-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1263"><a href="#cb94-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1264"><a href="#cb94-1264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modified the <span class="co">[</span><span class="ot">code use to simulate a single associated predictor</span><span class="co">](#simulating-an-associated-predictor)</span> by gradually increasing the error. This is done by increasing the 'sd' argument in <span class="in">`error &lt;- rnorm(n = n, sd = 2)`</span></span>
<span id="cb94-1265"><a href="#cb94-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1266"><a href="#cb94-1266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Take a look at how larger errors affect inference (so you also need to run the models)</span>
<span id="cb94-1267"><a href="#cb94-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1268"><a href="#cb94-1268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = FALSE}</span></span>
<span id="cb94-1269"><a href="#cb94-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1270"><a href="#cb94-1270" aria-hidden="true" tabindex="-1"></a><span class="in"># set seed</span></span>
<span id="cb94-1271"><a href="#cb94-1271" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb94-1272"><a href="#cb94-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1273"><a href="#cb94-1273" aria-hidden="true" tabindex="-1"></a><span class="in"># number of observations</span></span>
<span id="cb94-1274"><a href="#cb94-1274" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 50</span></span>
<span id="cb94-1275"><a href="#cb94-1275" aria-hidden="true" tabindex="-1"></a><span class="in">b0 &lt;- -4</span></span>
<span id="cb94-1276"><a href="#cb94-1276" aria-hidden="true" tabindex="-1"></a><span class="in">b1 &lt;- 3</span></span>
<span id="cb94-1277"><a href="#cb94-1277" aria-hidden="true" tabindex="-1"></a><span class="in">error &lt;- rnorm(n = n, sd = 10)</span></span>
<span id="cb94-1278"><a href="#cb94-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1279"><a href="#cb94-1279" aria-hidden="true" tabindex="-1"></a><span class="in"># random variables</span></span>
<span id="cb94-1280"><a href="#cb94-1280" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;-  rnorm(n = n, mean = 0, sd = 1)</span></span>
<span id="cb94-1281"><a href="#cb94-1281" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- b0 + b1 * x1 + error</span></span>
<span id="cb94-1282"><a href="#cb94-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1283"><a href="#cb94-1283" aria-hidden="true" tabindex="-1"></a><span class="in"># create data frame</span></span>
<span id="cb94-1284"><a href="#cb94-1284" aria-hidden="true" tabindex="-1"></a><span class="in">xy_data &lt;- data.frame(x1, y)</span></span>
<span id="cb94-1285"><a href="#cb94-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1286"><a href="#cb94-1286" aria-hidden="true" tabindex="-1"></a><span class="in"># build model</span></span>
<span id="cb94-1287"><a href="#cb94-1287" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(formula = y ~ x1, data = xy_data))</span></span>
<span id="cb94-1288"><a href="#cb94-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1289"><a href="#cb94-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1290"><a href="#cb94-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1291"><a href="#cb94-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now replace the error term with <span class="in">`error &lt;- rexp(n = n, rate = 0.2)`</span>. This is creating an error with an exponential distribution (so non-normal). This is supposed to be problematic for the inferential power of these models. Compare the estimates you got to the simulation values ('b0' and 'b1'). Explore the distribution of residuals (<span class="in">`plot_model(model_name, type = "diag")`</span>) for both 'normal' and 'exponential' error models. </span>
<span id="cb94-1292"><a href="#cb94-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1293"><a href="#cb94-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1294"><a href="#cb94-1294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = FALSE}</span></span>
<span id="cb94-1295"><a href="#cb94-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1296"><a href="#cb94-1296" aria-hidden="true" tabindex="-1"></a><span class="in"># set seed</span></span>
<span id="cb94-1297"><a href="#cb94-1297" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb94-1298"><a href="#cb94-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1299"><a href="#cb94-1299" aria-hidden="true" tabindex="-1"></a><span class="in"># number of observations</span></span>
<span id="cb94-1300"><a href="#cb94-1300" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 50</span></span>
<span id="cb94-1301"><a href="#cb94-1301" aria-hidden="true" tabindex="-1"></a><span class="in">b0 &lt;- -4</span></span>
<span id="cb94-1302"><a href="#cb94-1302" aria-hidden="true" tabindex="-1"></a><span class="in">b1 &lt;- 3</span></span>
<span id="cb94-1303"><a href="#cb94-1303" aria-hidden="true" tabindex="-1"></a><span class="in">error &lt;- rnorm(n = n,  sd = 5)</span></span>
<span id="cb94-1304"><a href="#cb94-1304" aria-hidden="true" tabindex="-1"></a><span class="in">sd(error)</span></span>
<span id="cb94-1305"><a href="#cb94-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1306"><a href="#cb94-1306" aria-hidden="true" tabindex="-1"></a><span class="in">error &lt;- rexp(n = n, rate = 0.2)</span></span>
<span id="cb94-1307"><a href="#cb94-1307" aria-hidden="true" tabindex="-1"></a><span class="in">sd(error)</span></span>
<span id="cb94-1308"><a href="#cb94-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1309"><a href="#cb94-1309" aria-hidden="true" tabindex="-1"></a><span class="in"># random variables</span></span>
<span id="cb94-1310"><a href="#cb94-1310" aria-hidden="true" tabindex="-1"></a><span class="in">x1 &lt;-  rnorm(n = n, mean = 0, sd = 1)</span></span>
<span id="cb94-1311"><a href="#cb94-1311" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- b0 + b1 * x1 + error</span></span>
<span id="cb94-1312"><a href="#cb94-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1313"><a href="#cb94-1313" aria-hidden="true" tabindex="-1"></a><span class="in"># create data frame</span></span>
<span id="cb94-1314"><a href="#cb94-1314" aria-hidden="true" tabindex="-1"></a><span class="in">xy_data &lt;- data.frame(x1, y)</span></span>
<span id="cb94-1315"><a href="#cb94-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1316"><a href="#cb94-1316" aria-hidden="true" tabindex="-1"></a><span class="in"># build model</span></span>
<span id="cb94-1317"><a href="#cb94-1317" aria-hidden="true" tabindex="-1"></a><span class="in">mod &lt;- lm(formula = y ~ x1, data = xy_data)</span></span>
<span id="cb94-1318"><a href="#cb94-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1319"><a href="#cb94-1319" aria-hidden="true" tabindex="-1"></a><span class="in">coef(mod)</span></span>
<span id="cb94-1320"><a href="#cb94-1320" aria-hidden="true" tabindex="-1"></a><span class="in">resd_mod &lt;- resid(mod)</span></span>
<span id="cb94-1321"><a href="#cb94-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1322"><a href="#cb94-1322" aria-hidden="true" tabindex="-1"></a><span class="in"># check distribution/ plot histogram</span></span>
<span id="cb94-1323"><a href="#cb94-1323" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = data.frame(resd_mod), mapping = aes(x = resd_mod)) + geom_histogram() </span></span>
<span id="cb94-1324"><a href="#cb94-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1325"><a href="#cb94-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1326"><a href="#cb94-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1327"><a href="#cb94-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Collinearity (the presence of correlated predictors) is supposed to affect the stability of multiple regression. The following code creates two highly collinear predictors ('x1' and 'x2'). The last line of code shows the correlation between them.</span>
<span id="cb94-1328"><a href="#cb94-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1331"><a href="#cb94-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1332"><a href="#cb94-1332" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-1333"><a href="#cb94-1333" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-1334"><a href="#cb94-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1335"><a href="#cb94-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-1336"><a href="#cb94-1336" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-1337"><a href="#cb94-1337" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb94-1338"><a href="#cb94-1338" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb94-1339"><a href="#cb94-1339" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb94-1340"><a href="#cb94-1340" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-1341"><a href="#cb94-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1342"><a href="#cb94-1342" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-1343"><a href="#cb94-1343" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-1344"><a href="#cb94-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1345"><a href="#cb94-1345" aria-hidden="true" tabindex="-1"></a><span class="co"># make x2 very similar to x2 (adding little variation)</span></span>
<span id="cb94-1346"><a href="#cb94-1346" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb94-1347"><a href="#cb94-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1348"><a href="#cb94-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x1, x2)</span>
<span id="cb94-1349"><a href="#cb94-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1350"><a href="#cb94-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1351"><a href="#cb94-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1352"><a href="#cb94-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb94-1353"><a href="#cb94-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1354"><a href="#cb94-1354" aria-hidden="true" tabindex="-1"></a><span class="in">xy_data &lt;- data.frame(x1, x2, y)</span></span>
<span id="cb94-1355"><a href="#cb94-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1356"><a href="#cb94-1356" aria-hidden="true" tabindex="-1"></a><span class="in"># build model</span></span>
<span id="cb94-1357"><a href="#cb94-1357" aria-hidden="true" tabindex="-1"></a><span class="in">xy_mod &lt;- lm(formula = y ~ x1 + x2, data = xy_data)</span></span>
<span id="cb94-1358"><a href="#cb94-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1359"><a href="#cb94-1359" aria-hidden="true" tabindex="-1"></a><span class="in">summary(xy_mod)</span></span>
<span id="cb94-1360"><a href="#cb94-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1361"><a href="#cb94-1361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1362"><a href="#cb94-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1363"><a href="#cb94-1363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Build a multiple regression model for this data (y ~ x1 + x2). You can use the same code as in the section <span class="co">[</span><span class="ot">Adding more than 1 predictor: multiple regression</span><span class="co">](#adding-more-than-1-predictor-multiple-regression)</span>.</span>
<span id="cb94-1364"><a href="#cb94-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1365"><a href="#cb94-1365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How is the inference affected by the presence of collinear predictors? Make the diagnostic plots for this model (<span class="in">`plot(model_name)`</span>).</span>
<span id="cb94-1366"><a href="#cb94-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1367"><a href="#cb94-1367" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simulate a data set with three predictors in which only two of them are highly collinear. Fit a multiple regression model (y ~ x1 + x2 + x3) for that data and look at how collinearity affects the estimate for the non-collinear predictor.</span>
<span id="cb94-1368"><a href="#cb94-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1369"><a href="#cb94-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1370"><a href="#cb94-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1371"><a href="#cb94-1371" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1372"><a href="#cb94-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1373"><a href="#cb94-1373" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1374"><a href="#cb94-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1375"><a href="#cb94-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1376"><a href="#cb94-1376" aria-hidden="true" tabindex="-1"></a><span class="fu"># Extending the linear models to more complex data structures</span></span>
<span id="cb94-1377"><a href="#cb94-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1378"><a href="#cb94-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1379"><a href="#cb94-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1380"><a href="#cb94-1380" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generalized linear models</span></span>
<span id="cb94-1381"><a href="#cb94-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1382"><a href="#cb94-1382" aria-hidden="true" tabindex="-1"></a>GLM's allow us to model the association to response variables that do not fit to a normal distribution. Furthermore, they allow to model distributions that more closely resemble the process that generated the data. The following data set creates a data set with a response representing counts (so non-normal):</span>
<span id="cb94-1383"><a href="#cb94-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1386"><a href="#cb94-1386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1387"><a href="#cb94-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb94-1388"><a href="#cb94-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1389"><a href="#cb94-1389" aria-hidden="true" tabindex="-1"></a><span class="co">#sample size</span></span>
<span id="cb94-1390"><a href="#cb94-1390" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb94-1391"><a href="#cb94-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1392"><a href="#cb94-1392" aria-hidden="true" tabindex="-1"></a><span class="co">#regression coefficients</span></span>
<span id="cb94-1393"><a href="#cb94-1393" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb94-1394"><a href="#cb94-1394" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb94-1395"><a href="#cb94-1395" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb94-1396"><a href="#cb94-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1397"><a href="#cb94-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1398"><a href="#cb94-1398" aria-hidden="true" tabindex="-1"></a><span class="co">#generate variables</span></span>
<span id="cb94-1399"><a href="#cb94-1399" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n, <span class="at">lambda =</span> <span class="fl">6.5</span>) <span class="co"># lambda = average rate of success</span></span>
<span id="cb94-1400"><a href="#cb94-1400" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, , <span class="fu">length</span>(y))</span>
<span id="cb94-1401"><a href="#cb94-1401" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(y) <span class="sc">-</span> b0 <span class="sc">-</span> b2 <span class="sc">*</span> x2) <span class="sc">/</span> b1</span>
<span id="cb94-1402"><a href="#cb94-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1403"><a href="#cb94-1403" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame</span></span>
<span id="cb94-1404"><a href="#cb94-1404" aria-hidden="true" tabindex="-1"></a>xy_data_pois <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb94-1405"><a href="#cb94-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1406"><a href="#cb94-1406" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_pois)</span>
<span id="cb94-1407"><a href="#cb94-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1408"><a href="#cb94-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1409"><a href="#cb94-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1410"><a href="#cb94-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1411"><a href="#cb94-1411" aria-hidden="true" tabindex="-1"></a>Let also plot 'x1' *vs* 'y':</span>
<span id="cb94-1414"><a href="#cb94-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1415"><a href="#cb94-1415" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb94-1416"><a href="#cb94-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xy_data_pois, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb94-1417"><a href="#cb94-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="co"># plot points</span></span>
<span id="cb94-1418"><a href="#cb94-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1419"><a href="#cb94-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1420"><a href="#cb94-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1421"><a href="#cb94-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1422"><a href="#cb94-1422" aria-hidden="true" tabindex="-1"></a>The relation does not seem very linear nor the variance seems to be constant across 'x1'.</span>
<span id="cb94-1423"><a href="#cb94-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1424"><a href="#cb94-1424" aria-hidden="true" tabindex="-1"></a>We can relaxed the normal distribution requirement with GLMs. <span class="in">`glm()`</span> is a base R function that help us do the trick. For this example the most appropriate distribution is *Poisson*. This can be set in the 'family' argument like this:</span>
<span id="cb94-1427"><a href="#cb94-1427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1428"><a href="#cb94-1428" aria-hidden="true" tabindex="-1"></a>glm_pois  <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_data_pois, <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb94-1429"><a href="#cb94-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1430"><a href="#cb94-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1431"><a href="#cb94-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1432"><a href="#cb94-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1433"><a href="#cb94-1433" aria-hidden="true" tabindex="-1"></a>As you can see the only extra argument compared to <span class="in">`lm()`</span> is 'family'. The rest is just the 'formula' and 'data' we are already familiar with. So again, we can build upon of our knowledge on linear models to extend them  to more complex data structures.</span>
<span id="cb94-1434"><a href="#cb94-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1435"><a href="#cb94-1435" aria-hidden="true" tabindex="-1"></a>We also need to run <span class="in">`summary()`</span> to get model output:</span>
<span id="cb94-1436"><a href="#cb94-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1439"><a href="#cb94-1439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1440"><a href="#cb94-1440" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_pois)</span>
<span id="cb94-1441"><a href="#cb94-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1442"><a href="#cb94-1442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1443"><a href="#cb94-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1444"><a href="#cb94-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1445"><a href="#cb94-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1446"><a href="#cb94-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1447"><a href="#cb94-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1448"><a href="#cb94-1448" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-success"&gt;</span>
<span id="cb94-1449"><a href="#cb94-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1450"><a href="#cb94-1450" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1451"><a href="#cb94-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1452"><a href="#cb94-1452" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;&lt;b&gt;Model interpretation&lt;/b&gt;&lt;/font&gt;</span>
<span id="cb94-1453"><a href="#cb94-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1454"><a href="#cb94-1454" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1455"><a href="#cb94-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1456"><a href="#cb94-1456" aria-hidden="true" tabindex="-1"></a>Coefficients table:</span>
<span id="cb94-1457"><a href="#cb94-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1458"><a href="#cb94-1458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb94-1459"><a href="#cb94-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1460"><a href="#cb94-1460" aria-hidden="true" tabindex="-1"></a><span class="in">summ_glm_pois &lt;- summary(glm_pois)</span></span>
<span id="cb94-1461"><a href="#cb94-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1462"><a href="#cb94-1462" aria-hidden="true" tabindex="-1"></a><span class="in">summ_glm_pois$coefficients</span></span>
<span id="cb94-1463"><a href="#cb94-1463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1464"><a href="#cb94-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1465"><a href="#cb94-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model tells us that $\beta_1$ (the effect size of 'x1') is <span class="in">`r summ_glm_pois$coefficients[2, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r summ_glm_pois$coefficients[2, 4]`</span>). This is actually interpreted as an increase in 1 unit of 'x1' results in 'y' (rate) by a factor of exp(<span class="in">`r summ_glm_pois$coefficients[2, 1]`</span>) = <span class="in">`r exp(summ_glm_pois$coefficients[2, 1])`</span>. </span>
<span id="cb94-1466"><a href="#cb94-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1467"><a href="#cb94-1467" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model also tells us that $\beta_2$ (the effect size of 'x2') is <span class="in">`r summ_glm_pois$coefficients[3, 1]`</span> and that it is significantly different from 0 (p-value = <span class="in">`r summ_glm_pois$coefficients[3, 4]`</span>). This is means that an increase in 1 unit of 'x2' results in 'y' (rate) by a factor of exp(<span class="in">`r summ_glm_pois$coefficients[3, 1]`</span>) = <span class="in">`r exp(summ_glm_pois$coefficients[3, 1])`</span>. </span>
<span id="cb94-1468"><a href="#cb94-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1469"><a href="#cb94-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1470"><a href="#cb94-1470" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1471"><a href="#cb94-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1472"><a href="#cb94-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1473"><a href="#cb94-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1474"><a href="#cb94-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1475"><a href="#cb94-1475" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb94-1476"><a href="#cb94-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1477"><a href="#cb94-1477" aria-hidden="true" tabindex="-1"></a>&lt;font size="5"&gt;Exercise&lt;/font&gt; </span>
<span id="cb94-1478"><a href="#cb94-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1479"><a href="#cb94-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1480"><a href="#cb94-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1481"><a href="#cb94-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Try fitting a <span class="in">`lm()`</span> model (so with a gaussian distribution), compare the results and check the residuals (<span class="in">`plot_model(model_name, type = "diag")`</span>)</span>
<span id="cb94-1482"><a href="#cb94-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1483"><a href="#cb94-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1484"><a href="#cb94-1484" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb94-1485"><a href="#cb94-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1486"><a href="#cb94-1486" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1487"><a href="#cb94-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1488"><a href="#cb94-1488" aria-hidden="true" tabindex="-1"></a>Many other distribution and link functions are available:</span>
<span id="cb94-1489"><a href="#cb94-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1490"><a href="#cb94-1490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "80%", echo = FALSE, fig.align= "center"}</span></span>
<span id="cb94-1491"><a href="#cb94-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1492"><a href="#cb94-1492" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("./images/link-functions.jpg")</span></span>
<span id="cb94-1493"><a href="#cb94-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1494"><a href="#cb94-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1495"><a href="#cb94-1495" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb94-1496"><a href="#cb94-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1497"><a href="#cb94-1497" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1498"><a href="#cb94-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1499"><a href="#cb94-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mixed-effect models</span></span>
<span id="cb94-1500"><a href="#cb94-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1501"><a href="#cb94-1501" aria-hidden="true" tabindex="-1"></a>Sometimes our data sets include additional levels of structure. For instance, when we sample several individuals from different populations. In those cases variation at the higher structural level (populations) might preclude detecting patterns at the lower level (individuals).</span>
<span id="cb94-1502"><a href="#cb94-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1503"><a href="#cb94-1503" aria-hidden="true" tabindex="-1"></a>Let's simulate some data that resembles that scenario. We have two continuous predictor (x1) and a continuous response (y). Each sample comes from 1 of 8 different populations (pops):</span>
<span id="cb94-1504"><a href="#cb94-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1507"><a href="#cb94-1507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1508"><a href="#cb94-1508" aria-hidden="true" tabindex="-1"></a><span class="co"># x&lt;- 1</span></span>
<span id="cb94-1509"><a href="#cb94-1509" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb94-1510"><a href="#cb94-1510" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">28</span>)</span>
<span id="cb94-1511"><a href="#cb94-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1512"><a href="#cb94-1512" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations</span></span>
<span id="cb94-1513"><a href="#cb94-1513" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb94-1514"><a href="#cb94-1514" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb94-1515"><a href="#cb94-1515" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb94-1516"><a href="#cb94-1516" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-1517"><a href="#cb94-1517" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb94-1518"><a href="#cb94-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1519"><a href="#cb94-1519" aria-hidden="true" tabindex="-1"></a><span class="co"># random variables</span></span>
<span id="cb94-1520"><a href="#cb94-1520" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span>  <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb94-1521"><a href="#cb94-1521" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> pops <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb94-1522"><a href="#cb94-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1523"><a href="#cb94-1523" aria-hidden="true" tabindex="-1"></a><span class="co"># add letters</span></span>
<span id="cb94-1524"><a href="#cb94-1524" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">&lt;-</span> letters[pops <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb94-1525"><a href="#cb94-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1526"><a href="#cb94-1526" aria-hidden="true" tabindex="-1"></a><span class="co"># create data set</span></span>
<span id="cb94-1527"><a href="#cb94-1527" aria-hidden="true" tabindex="-1"></a>xy_data_pops <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y, pops)</span>
<span id="cb94-1528"><a href="#cb94-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1529"><a href="#cb94-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xy_data_pops, <span class="dv">10</span>)</span>
<span id="cb94-1530"><a href="#cb94-1530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1531"><a href="#cb94-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1532"><a href="#cb94-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1533"><a href="#cb94-1533" aria-hidden="true" tabindex="-1"></a>We can explore the relation between y and x1 with a plot:</span>
<span id="cb94-1536"><a href="#cb94-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1537"><a href="#cb94-1537" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_pops, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb94-1538"><a href="#cb94-1538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb94-1539"><a href="#cb94-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1540"><a href="#cb94-1540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1541"><a href="#cb94-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1542"><a href="#cb94-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1543"><a href="#cb94-1543" aria-hidden="true" tabindex="-1"></a>can you clearly see the pattern of association between the two variables we used to simulate the data? We can further explore the data with a simple linear regression model:</span>
<span id="cb94-1544"><a href="#cb94-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1547"><a href="#cb94-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1548"><a href="#cb94-1548" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x1, <span class="at">data =</span> xy_data_pops))</span>
<span id="cb94-1549"><a href="#cb94-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1550"><a href="#cb94-1550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1551"><a href="#cb94-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1552"><a href="#cb94-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1553"><a href="#cb94-1553" aria-hidden="true" tabindex="-1"></a>Despite having simulated a non-zero $\beta_1$ we have no significant association according to this model and the estimated for $\beta_1$ is far from the simulated one. This poor inference is due to the fact that we are ignoring an important feature of our data, the grouping of samples in 'populations'.</span>
<span id="cb94-1554"><a href="#cb94-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1555"><a href="#cb94-1555" aria-hidden="true" tabindex="-1"></a>Mixed-effect models (a.k.a. multi-level models or varying effect models) can help us account for these additional features, significantly improving our inferential power. Let's color each of the populations to see how the variables co-vary for each data sub-group:  </span>
<span id="cb94-1556"><a href="#cb94-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1559"><a href="#cb94-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1560"><a href="#cb94-1560" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_data_pops, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y, <span class="at">color =</span> pops)) <span class="sc">+</span> </span>
<span id="cb94-1561"><a href="#cb94-1561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb94-1562"><a href="#cb94-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1563"><a href="#cb94-1563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1564"><a href="#cb94-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1565"><a href="#cb94-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1566"><a href="#cb94-1566" aria-hidden="true" tabindex="-1"></a>There seems to be a clear pattern of positive association between x1 and y. The pattern becomes a bit more obvious if we plot each population in its own panel:</span>
<span id="cb94-1567"><a href="#cb94-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1568"><a href="#cb94-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width= "100%"}</span></span>
<span id="cb94-1569"><a href="#cb94-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1570"><a href="#cb94-1570" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = xy_data_pops, aes(x = x1, y = y, color = pops)) +</span></span>
<span id="cb94-1571"><a href="#cb94-1571" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb94-1572"><a href="#cb94-1572" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap( ~ pops) +</span></span>
<span id="cb94-1573"><a href="#cb94-1573" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE) </span></span>
<span id="cb94-1574"><a href="#cb94-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1575"><a href="#cb94-1575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1576"><a href="#cb94-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1577"><a href="#cb94-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1578"><a href="#cb94-1578" aria-hidden="true" tabindex="-1"></a>Let's build a mixed-effect model using population as a varying intercept:</span>
<span id="cb94-1579"><a href="#cb94-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1582"><a href="#cb94-1582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb94-1583"><a href="#cb94-1583" aria-hidden="true" tabindex="-1"></a>mix_eff_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> pops))</span>
<span id="cb94-1584"><a href="#cb94-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1585"><a href="#cb94-1585" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mix_eff_mod)</span>
<span id="cb94-1586"><a href="#cb94-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1587"><a href="#cb94-1587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb94-1588"><a href="#cb94-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1589"><a href="#cb94-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1590"><a href="#cb94-1590" aria-hidden="true" tabindex="-1"></a>The model correctly detected the simulated pattern and the estimate for $\beta_1$ (<span class="in">`r fixef(mix_eff_mod)[2]`</span>) is very close to the simulated value.</span>
<span id="cb94-1591"><a href="#cb94-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1592"><a href="#cb94-1592" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1593"><a href="#cb94-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1594"><a href="#cb94-1594" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb94-1595"><a href="#cb94-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1596"><a href="#cb94-1596" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Richard McElreath's Statistical Rethinking book</span><span class="co">](https://github.com/rmcelreath/stat_rethinking_2022)</span> </span>
<span id="cb94-1597"><a href="#cb94-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1598"><a href="#cb94-1598" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R's rbinom – Simulate Binomial or Bernoulli trials</span><span class="co">](https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rbinom/)</span></span>
<span id="cb94-1599"><a href="#cb94-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1600"><a href="#cb94-1600" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R's rnorm – selecting values from a normal distribution</span><span class="co">](https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rnorm/)</span></span>
<span id="cb94-1601"><a href="#cb94-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1602"><a href="#cb94-1602" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R's exp – Simulating Exponential Distributions</span><span class="co">](https://www.programmingr.com/examples/neat-tricks/sample-r-function/rexp/)</span></span>
<span id="cb94-1603"><a href="#cb94-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1604"><a href="#cb94-1604" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Simulating data in R</span><span class="co">](https://aosmith.rbind.io/2018/08/29/getting-started-simulating-data/)</span></span>
<span id="cb94-1605"><a href="#cb94-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1606"><a href="#cb94-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1607"><a href="#cb94-1607" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb94-1608"><a href="#cb94-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1609"><a href="#cb94-1609" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information {.unnumbered .unlisted}</span></span>
<span id="cb94-1610"><a href="#cb94-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1611"><a href="#cb94-1611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session info, echo=F}</span></span>
<span id="cb94-1612"><a href="#cb94-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1613"><a href="#cb94-1613" aria-hidden="true" tabindex="-1"></a><span class="in">sessionInfo()</span></span>
<span id="cb94-1614"><a href="#cb94-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-1615"><a href="#cb94-1615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024 | <a href="https://marce10.github.io">Marcelo Araya-Salas</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>